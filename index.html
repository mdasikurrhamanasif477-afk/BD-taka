<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<script async src="https://ss.mrmnd.com/banner.js"></script>
	<script async src="https://ss.mrmnd.com/interstitial.js" data-mndintid="93b744e5-2156-4a15-9bb5-49393991fd87"></script>
	<script async src="https://js.wpadmngr.com/static/adManager.js" data-admpid="131151"></script>
    <script async src="https://ss.mrmnd.com/native.js"></script>
	
    <title>Earning Pro App - Betting Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
   
    <style>
        :root {
            --primary-color: #00d2ff;
            --secondary-color: #3a7bd5;
            --accent-color: #ffcc00;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #f8fafc;
            --text-muted: #94a3b8;
            --danger: #ef4444;
            --success: #22c55e;
            /* Betting Theme Colors (1xBET Style) */
            --bet-green: #00e676;
            --bet-dark: #121212;
            --bet-card: #1e1e1e;
            --bet-odd-btn: #2c2c2c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Hind Siliguri', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-color); color: var(--text-color); overflow-x: hidden; min-height: 100vh; display: flex; flex-direction: column; }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Auth Section --- */
        .auth-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, var(--bg-color), var(--secondary-color)); padding: 20px; }
        .auth-box { background: var(--card-bg); padding: 2rem; border-radius: 20px; width: 100%; max-width: 400px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); }
        .auth-header h2 { text-align: center; margin-bottom: 1.5rem; color: var(--primary-color); font-size: 2rem; text-shadow: 0 0 10px rgba(0, 210, 255, 0.3); }
        .form-group { margin-bottom: 1.2rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; color: var(--text-muted); }
        .form-control { width: 100%; padding: 12px 15px; border-radius: 10px; border: 1px solid #334155; background: #0f172a; color: white; font-size: 1rem; transition: 0.3s; }
        .form-control:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 10px rgba(0, 210, 255, 0.2); }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;}
        .btn-primary { background: linear-gradient(to right, var(--secondary-color), var(--primary-color)); color: white; box-shadow: 0 4px 15px rgba(0, 210, 255, 0.4); }
        .btn-primary:hover { transform: translateY(-2px); }
        .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; }
        .switch-auth { text-align: center; margin-top: 15px; font-size: 0.9rem; color: var(--text-muted); }
        .switch-auth span { color: var(--primary-color); cursor: pointer; font-weight: bold; text-decoration: underline; }

        /* --- Main App --- */
        #app-container { max-width: 480px; margin: 0 auto; width: 100%; background: var(--bg-color); min-height: 100vh; position: relative; padding-bottom: 80px; }
        
        /* Header Ads */
        .header-ads { 
            background: linear-gradient(90deg, #8b5cf6, #ec4899); 
            margin: 10px 15px; 
            border-radius: 12px; 
            height: 80px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
        }
        .header-ads-content { text-align: center; color: white; padding: 10px; width: 100%; }
        .header-ads-title { font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; }
        .header-ads-desc { font-size: 0.7rem; opacity: 0.9; }
        .header-ads-close {
            position: absolute; top: 5px; right: 8px; color: white; cursor: pointer;
            font-size: 0.8rem; background: rgba(0,0,0,0.3); border-radius: 50%;
            width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;
        }
        
        .user-header { background: linear-gradient(135deg, #1e293b, #0f172a); padding: 20px; margin: 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); position: relative; }
        .user-icon { width: 50px; height: 50px; background: var(--secondary-color); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; margin-right: 15px; box-shadow: 0 0 10px rgba(58, 123, 213, 0.5); }
        .user-info { flex: 1; }
        .user-info h3 { font-size: 1.1rem; margin-bottom: 2px; }
        .user-info p { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 2px; }
        .ip-badge { display: inline-block; background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; color: var(--accent-color); border: 1px solid var(--accent-color); }
        .user-balance { margin-top: 10px; background: rgba(0, 210, 255, 0.1); padding: 10px; border-radius: 8px; text-align: center; border: 1px solid rgba(0, 210, 255, 0.3); }
        .balance-amount { font-size: 1.5rem; color: var(--accent-color); font-weight: bold; text-shadow: 0 0 5px rgba(255, 204, 0, 0.3); }

        /* --- Menu Grid --- */
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 15px; }
        .menu-item { background: var(--card-bg); padding: 20px; border-radius: 15px; text-align: center; cursor: pointer; transition: 0.3s; border: 1px solid rgba(255,255,255,0.05); }
        .menu-item:hover { transform: translateY(-3px); border-color: var(--primary-color); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .menu-icon { font-size: 2rem; margin-bottom: 10px; display: inline-block; }
        .menu-title { font-weight: 600; font-size: 1rem; }

        /* --- Live Feed --- */
        .live-feed-container { margin: 15px; background: var(--card-bg); border-radius: 15px; padding: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .live-feed-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        .live-indicator { display: flex; align-items: center; color: var(--danger); font-size: 0.8rem; font-weight: bold; }
        .dot { width: 8px; height: 8px; background: var(--danger); border-radius: 50%; margin-right: 5px; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .feed-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); animation: slideIn 0.5s ease-out; }
        .feed-avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 12px; object-fit: cover; }
        .feed-details h4 { font-size: 0.9rem; color: var(--text-color); }
        .feed-details p { font-size: 0.8rem; color: var(--success); }
        .feed-time { font-size: 0.7rem; color: var(--text-muted); margin-left: auto; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }

        /* --- Footer Ad --- */
        .footer-ad { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 480px; height: 160px; background: #000; display: flex; justify-content: center; align-items: center; border-top: 2px solid var(--accent-color); z-index: 90; }
        .ad-placeholder { width: 100%; height: 100%; background: #111; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #555; font-size: 0.8rem; }

        /* --- Modals --- */
        .popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(5px); }
        .popup-content { background: var(--card-bg); padding: 25px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; border: 1px solid var(--primary-color); box-shadow: 0 0 20px rgba(0, 210, 255, 0.3); animation: zoomIn 0.3s ease; max-height: 90vh; overflow-y: auto; position: relative; }
        @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(30, 41, 59, 0.95); color: white; padding: 12px 24px; border-radius: 50px; border: 1px solid var(--primary-color); z-index: 2000; opacity: 0; transition: opacity 0.3s; pointer-events: none; font-weight: 500; max-width: 90%; text-align: center; white-space: pre-line;}
        .toast.show { opacity: 1; }

        /* =========================================
           New WithDRAWAL STYLES
           ========================================= */
        .withdraw-header { background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01)); border-radius: 12px; padding: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); }
        .withdraw-avail-title { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 5px; }
        .withdraw-avail-amount { font-size: 2rem; font-weight: bold; color: var(--accent-color); text-shadow: 0 0 10px rgba(255, 204, 0, 0.2); }
        .payment-methods { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .pay-method-card { background: rgba(0,0,0,0.2); border: 2px solid transparent; border-radius: 12px; padding: 15px 5px; text-align: center; cursor: pointer; transition: all 0.3s ease; position: relative; }
        .pay-method-card:hover { background: rgba(255,255,255,0.05); }
        .pay-method-card.selected { border-color: var(--primary-color); background: rgba(0, 210, 255, 0.1); box-shadow: 0 0 15px rgba(0, 210, 255, 0.2); }
        .pay-icon { font-size: 1.8rem; margin-bottom: 5px; display: block; }
        .pay-name { font-size: 0.75rem; font-weight: 600; color: var(--text-muted); }
        .pay-method-card.selected .pay-name { color: var(--primary-color); }
        .method-bkash .pay-icon { color: #E2136E; }
        .method-nagad .pay-icon { color: #F7941D; }
        .method-rocket .pay-icon { color: #8B34F9; }
        .withdraw-form { margin-bottom: 20px; }
        .withdraw-note { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 15px; background: rgba(239, 68, 68, 0.1); padding: 10px; border-radius: 8px; text-align: left; border-left: 3px solid var(--danger); }
        .withdraw-note span { color: var(--accent-color); font-weight: bold; }
        .history-section { margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; text-align: left; }
        .history-title { font-size: 0.9rem; font-weight: bold; margin-bottom: 10px; color: var(--text-muted); display: flex; justify-content: space-between; }
        .history-list { max-height: 200px; overflow-y: auto; }
        .history-item { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.03); }
        .h-left { display: flex; flex-direction: column; gap: 2px; }
        .h-method { font-size: 0.8rem; font-weight: bold; color: var(--text-color); }
        .h-date { font-size: 0.65rem; color: var(--text-muted); }
        .h-right { text-align: right; }
        .h-amount { font-size: 0.9rem; font-weight: bold; color: var(--success); }
        .h-status { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; background: rgba(255,255,255,0.1); margin-top: 2px; display: inline-block; }
        .status-pending { color: var(--accent-color); background: rgba(255, 204, 0, 0.1); }
        .status-approved { color: var(--success); background: rgba(34, 197, 94, 0.1); }
        .status-rejected { color: var(--danger); background: rgba(239, 68, 68, 0.1); }

        /* =========================================
           NEW ADD MONEY STYLES
           ========================================= */
        .add-money-modal .popup-content { border: 1px solid #10b981; box-shadow: 0 0 20px rgba(16, 185, 129, 0.3); }
        .bonus-banner { background: linear-gradient(135deg, #10b981, #059669); border-radius: 12px; padding: 15px; margin-bottom: 20px; color: white; position: relative; overflow: hidden; }
        .bonus-badge { background: #fff; color: #059669; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; display: inline-block; margin-bottom: 5px; }
        .bonus-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; position: relative; z-index: 1; }
        .bonus-desc { font-size: 0.8rem; opacity: 0.9; position: relative; z-index: 1; }
        .promo-input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .promo-input { flex: 1; background: rgba(0,0,0,0.2); border: 1px solid #334155; color: white; padding: 10px; border-radius: 8px; text-transform: uppercase; font-weight: bold; letter-spacing: 1px; }
        .apply-btn { background: #334155; color: white; border: none; padding: 0 15px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; }
        .apply-btn:hover { background: #475569; }
        .agent-info { background: rgba(16, 185, 129, 0.1); border: 1px dashed #10b981; padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: left; }
        .agent-number { font-size: 1.2rem; color: #fff; font-weight: bold; letter-spacing: 1px; margin: 5px 0; display: block; }
        .copy-icon { color: #10b981; cursor: pointer; margin-left: 10px; }
        .deposit-history-item .h-amount { color: #10b981; }

        /* =========================================
           REFERRAL MODAL STYLES
           ========================================= */
        #referral-modal .popup-content { max-width: 420px; text-align: left; padding: 20px; }
        .ref-header { text-align: center; margin-bottom: 20px; position: relative; }
        .ref-code-box { background: rgba(255, 255, 255, 0.05); border: 1px dashed var(--primary-color); padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 15px; position: relative; }
        .ref-code-display { font-size: 1.8rem; font-weight: bold; color: var(--accent-color); letter-spacing: 2px; margin: 10px 0; font-family: monospace; }
        .copy-btn { background: rgba(255,255,255,0.1); color: white; border: none; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; transition: 0.2s; display: inline-flex; align-items: center; gap: 5px; }
        .copy-btn:hover { background: var(--primary-color); }
        .qr-placeholder { width: 100px; height: 100px; background: white; margin: 0 auto 10px auto; padding: 5px; border-radius: 10px; }
        .qr-placeholder img { width: 100%; height: 100%; object-fit: contain; }
        .share-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .share-item { display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer; font-size: 0.7rem; color: var(--text-muted); }
        .share-icon-box { width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; transition: transform 0.2s; }
        .share-item:hover .share-icon-box { transform: scale(1.1); }
        .bg-wa { background: #25D366; color: white; }
        .bg-fb { background: #1877F2; color: white; }
        .bg-tg { background: #0088cc; color: white; }
        .bg-copy { background: #64748b; color: white; }
        .steps-guide { display: flex; justify-content: space-between; margin-bottom: 20px; position: relative; }
        .steps-guide::before { content: ''; position: absolute; top: 15px; left: 20px; right: 20px; height: 2px; background: rgba(255,255,255,0.1); z-index: 0; }
        .step-item { position: relative; z-index: 1; text-align: center; flex: 1; }
        .step-icon-box { width: 32px; height: 32px; background: var(--card-bg); border: 2px solid var(--secondary-color); border-radius: 50%; display: flex; justify-content: center; align-items: center; margin: 0 auto 5px auto; font-size: 0.8rem; color: var(--primary-color); }
        .step-text { font-size: 0.65rem; color: var(--text-muted); line-height: 1.2; }
        .invite-banner { background: linear-gradient(45deg, #ec4899, #8b5cf6); padding: 12px; border-radius: 10px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3); animation: pulse 2s infinite; }
        .invite-text h4 { font-size: 0.9rem; color: white; margin-bottom: 2px; }
        .invite-text p { font-size: 0.7rem; color: rgba(255,255,255,0.8); }
        .invite-btn-icon { background: white; color: #ec4899; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1rem; cursor: pointer; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-val { font-size: 1.2rem; font-weight: bold; color: var(--success); }
        .stat-label { font-size: 0.7rem; color: var(--text-muted); }
        .leaderboard-section { background: rgba(0,0,0,0.2); border-radius: 10px; padding: 10px; margin-bottom: 20px; }
        .lb-header { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--accent-color); margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; }
        .lb-list { list-style: none; }
        .lb-item { display: flex; align-items: center; margin-bottom: 8px; font-size: 0.8rem; }
        .lb-rank { width: 20px; font-weight: bold; color: var(--text-muted); }
        .lb-name { flex: 1; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 120px; }
        .lb-earn { font-weight: bold; color: var(--success); }
        .lb-avatar { width: 24px; height: 24px; border-radius: 50%; margin-right: 8px; object-fit: cover; }
        .ref-list-header { font-size: 0.85rem; font-weight: bold; margin-bottom: 10px; border-left: 3px solid var(--primary-color); padding-left: 8px; }
        .referral-scroll-list { max-height: 150px; overflow-y: auto; margin-bottom: 15px; }
        .ref-list-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.02); padding: 8px 10px; border-radius: 8px; margin-bottom: 6px; border: 1px solid rgba(255,255,255,0.03); }
        .ref-user-info { display: flex; align-items: center; gap: 10px; }
        .ref-avatar-small { width: 30px; height: 30px; background: #334155; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; color: #ccc; }
        .ref-name { font-size: 0.8rem; font-weight: 500; }
        .ref-date { font-size: 0.65rem; color: var(--text-muted); }
        .ref-status-badge { padding: 3px 8px; border-radius: 12px; font-size: 0.65rem; font-weight: bold; }
        .status-pending { background: rgba(255, 204, 0, 0.15); color: var(--accent-color); }
        .status-active { background: rgba(34, 197, 94, 0.15); color: var(--success); }
        .status-inactive { background: rgba(148, 163, 184, 0.15); color: var(--text-muted); }
        .ref-earned { font-size: 0.75rem; color: var(--success); font-weight: bold; text-align: right; }
        .ref-rules { font-size: 0.75rem; background: rgba(239, 68, 68, 0.1); border-left: 3px solid var(--danger); padding: 10px; margin-bottom: 10px; border-radius: 0 5px 5px 0; }
        .withdraw-info-box { font-size: 0.75rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2); padding: 10px; border-radius: 8px; color: #bae6fd; }

        /* =========================================
           MEMBERSHIP MODAL STYLES
           ========================================= */
        #membership-plans-modal .popup-content, #payment-modal .popup-content, #my-membership-modal .popup-content { max-width: 400px; text-align: left; }
        .plan-grid { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
        .plan-card { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 12px; position: relative; overflow: hidden; transition: 0.3s; }
        .plan-card:hover { transform: translateY(-2px); border-color: var(--primary-color); }
        .plan-card.vip { border: 1px solid var(--accent-color); box-shadow: 0 0 15px rgba(255, 204, 0, 0.1); }
        .plan-card.vip::before { content: "POPULAR"; position: absolute; top: 0; right: 0; background: var(--accent-color); color: #000; font-size: 0.6rem; padding: 2px 8px; font-weight: bold; border-bottom-left-radius: 10px; }
        .plan-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .plan-name { font-weight: bold; font-size: 1.1rem; }
        .plan-price { font-size: 1.2rem; font-weight: bold; color: var(--success); }
        .plan-detail { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 5px; display: flex; justify-content: space-between; }
        .plan-total { border-top: 1px dashed rgba(255,255,255,0.1); padding-top: 5px; margin-top: 5px; font-size: 0.75rem; color: var(--text-muted); text-align: right; }
        .buy-btn { width: 100%; padding: 10px; border: none; border-radius: 8px; background: var(--secondary-color); color: white; font-weight: 600; cursor: pointer; margin-top: 5px; transition: 0.2s; }
        .buy-btn:hover { background: var(--primary-color); }
        .payment-summary { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        .payment-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; }
        .payment-total { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px; font-weight: bold; color: var(--accent-color); font-size: 1.1rem; }
        .membership-status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }
        .status-active { background: rgba(34, 197, 94, 0.2); color: var(--success); border: 1px solid var(--success); }
        .status-expired { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }
        .claim-section { background: linear-gradient(135deg, rgba(255, 204, 0, 0.1), rgba(0, 0, 0, 0)); border: 1px solid var(--accent-color); padding: 15px; border-radius: 15px; text-align: center; margin: 20px 0; }
        .claim-btn-large { background: linear-gradient(45deg, #f59e0b, #d97706); color: white; border: none; padding: 15px 30px; border-radius: 50px; font-size: 1.1rem; font-weight: bold; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4); cursor: pointer; width: 100%; transition: 0.3s; }
        .claim-btn-large:disabled { background: #4b5563; cursor: not-allowed; box-shadow: none; }
        .claim-timer { font-family: monospace; font-size: 1.2rem; color: var(--text-muted); margin-top: 10px; }
        .policy-text { font-size: 0.7rem; color: #64748b; margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 10px; }
        .history-list { margin-top: 15px; max-height: 200px; overflow-y: auto; }
        .history-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.8rem; }
        .history-status { font-weight: bold; }
        .history-success { color: var(--success); }
        .history-missed { color: var(--danger); }

        /* =========================================
           IN-APP BROWSER STYLES (SIDEBAR ADS)
           ========================================= */
        .in-app-browser-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 3000; display: flex; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .browser-sidebar { width: 70px; background: linear-gradient(180deg, #1e293b, #0f172a); display: flex; flex-direction: column; align-items: center; padding-top: 20px; border-right: 1px solid rgba(255,255,255,0.1); box-shadow: 2px 0 10px rgba(0,0,0,0.2); flex-shrink: 0; }
        .sidebar-close-btn { width: 40px; height: 40px; background: rgba(239, 68, 68, 0.2); color: var(--danger); border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-bottom: 30px; cursor: pointer; transition: 0.2s; }
        .sidebar-close-btn:hover { background: var(--danger); color: white; }
        .timer-container { display: flex; flex-direction: column; align-items: center; color: white; text-align: center; }
        .timer-icon { font-size: 1.5rem; color: var(--accent-color); margin-bottom: 10px; }
        .timer-icon.waiting { color: #3b82f6; animation: bounce 1s infinite; }
        .timer-icon.success { color: var(--success); animation: none; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .timer-circle { width: 50px; height: 50px; border-radius: 50%; border: 3px solid var(--primary-color); display: flex; justify-content: center; align-items: center; font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; box-shadow: 0 0 10px rgba(0, 210, 255, 0.3); }
        .timer-label { font-size: 0.65rem; color: var(--text-muted); max-width: 60px; line-height: 1.2; }
        .browser-view { flex: 1; position: relative; background: #f1f5f9; }
        .browser-header { height: 50px; background: #fff; display: flex; align-items: center; padding: 0 15px; border-bottom: 1px solid #e2e8f0; color: #333; font-size: 0.9rem; }
        .browser-address { flex: 1; background: #f1f5f9; padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; color: #64748b; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-left: 10px; }
        .browser-frame { width: 100%; height: calc(100% - 50px); border: none; background: white; }
        
        /* Sidebar Ads */
        .sidebar-ad { width: 60px; height: 200px; background: linear-gradient(180deg, #3b82f6, #1d4ed8); margin: 10px 5px; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-size: 0.6rem; text-align: center; border: 1px solid rgba(255,255,255,0.2); cursor: pointer; transition: transform 0.2s; }
        .sidebar-ad:hover { transform: scale(1.05); }
        .sidebar-ad i { font-size: 1.2rem; margin-bottom: 8px; }
        .sidebar-ad-top { background: linear-gradient(180deg, #ec4899, #be185d); }
        .sidebar-ad-bottom { background: linear-gradient(180deg, #10b981, #047857); }
        .right-sidebar-ad {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            width: 80px; height: 250px; background: linear-gradient(180deg, #f59e0b, #b45309);
            border-radius: 10px; display: flex; flex-direction: column; align-items: center;
            justify-content: center; color: white; font-size: 0.6rem; text-align: center;
            padding: 10px; border: 1px solid rgba(255,255,255,0.2); z-index: 10; cursor: pointer;
        }
        .right-sidebar-ad:hover { transform: translateY(-50%) scale(1.05); }
        .right-sidebar-ad i { font-size: 1.5rem; margin-bottom: 10px; }

        /* =========================================
           DAILY TASK CSS STYLES
           ========================================= */
        .task-buttons-container { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        .task-category-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; color: var(--text-color); font-size: 0.95rem; cursor: pointer; transition: all 0.3s ease; display: flex; justify-content: space-between; align-items: center; position: relative; overflow: hidden; }
        .task-category-btn:hover { background: rgba(255,255,255,0.1); }
        .task-category-btn.active { background: linear-gradient(90deg, var(--secondary-color), var(--primary-color)); border-color: var(--primary-color); color: white; box-shadow: 0 4px 15px rgba(0, 210, 255, 0.3); font-weight: bold; }
        .btn-content { display: flex; align-items: center; gap: 10px; }
        .btn-icon { font-size: 1.2rem; width: 24px; text-align: center; }
        .btn-reward { background: rgba(0,0,0,0.2); padding: 4px 8px; border-radius: 6px; font-size: 0.85rem; color: var(--accent-color); }
        .task-category-btn.active .btn-reward { background: rgba(255,255,255,0.2); color: white; }
        .task-list { list-style: none; max-height: 300px; overflow-y: auto; padding: 5px; }
        .task-item { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; border: 1px solid transparent; }
        .task-item.active-task { border-color: var(--primary-color); background: rgba(0, 210, 255, 0.1); }
        .task-item.completed-task { border-color: var(--success); opacity: 0.7; }
        .task-info { flex: 1; padding-left: 10px; }
        .task-info h4 { font-size: 0.9rem; margin-bottom: 3px; }
        .task-info p { font-size: 0.75rem; color: var(--accent-color); }
        .task-action { text-align: right; }
        .task-btn { background: var(--secondary-color); color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; }
        .task-btn:disabled { background: #555; cursor: not-allowed; }
        .task-btn.install-btn { background: #8e44ad; }
        .task-btn.survey-btn { background: #f59e0b; }
        .task-btn.mega-btn { background: #ec4899; }
        .timer-badge { display: block; font-size: 0.7rem; color: var(--text-muted); margin-top: 4px; }
        .close-small-btn { margin-top: 10px; background: transparent; color: #aaa; border: 1px solid #444; width: 100%; }

        /* Spin Wheel Styles */
        #spin-modal-content { background: #1a1a2e; position: relative; padding-bottom: 20px; }
        .wheel-wrapper { position: relative; width: 300px; height: 300px; margin: 0 auto 20px auto; }
        .wheel-arrow { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 35px solid #fff; z-index: 20; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.5)); }
        .wheel-border { width: 100%; height: 100%; border-radius: 50%; border: 10px solid #333; box-shadow: 0 0 20px rgba(0,0,0,0.8), inset 0 0 10px rgba(0,0,0,0.5); position: relative; overflow: hidden; background: #000; padding: 5px; box-sizing: border-box; }
        .wheel-inner { 
            width: 100%; height: 100%; border-radius: 50%; 
            background: conic-gradient(#FF5733 0deg 45deg, #C70039 45deg 90deg, #900C3F 90deg 135deg, #581845 135deg 180deg, #28B463 180deg 225deg, #1ABC9C 225deg 270deg, #2980B9 270deg 315deg, #D35400 315deg 360deg); 
            position: relative; transition: transform 4s cubic-bezier(0.2, 0.8, 0.2, 0.99); box-shadow: inset 0 0 15px rgba(0,0,0,0.5); 
        }
        .wheel-lines { position: absolute; width: 100%; height: 100%; border-radius: 50%; background: repeating-conic-gradient(rgba(0,0,0,0.3) 0deg 2deg, transparent 2deg 45deg); pointer-events: none; }
        .wheel-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: radial-gradient(circle at 30% 30%, #fff, #ddd, #999); border-radius: 50%; border: 4px solid #ffd700; z-index: 15; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .spin-btn { background: linear-gradient(45deg, #ff9f43, #ff6b6b); border: none; padding: 15px 40px; border-radius: 50px; color: white; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4); transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; text-shadow: 0 2px 2px rgba(0,0,0,0.3); }
        .spin-btn:disabled { background: #555; cursor: not-allowed; box-shadow: none; }
        .timer-display { color: var(--accent-color); font-size: 1.1rem; margin-top: 10px; font-weight: bold; }

        /* =========================================
           MODIFIED: DAILY BONUS & DOUBLE BONUS
           ========================================= */
        .daily-bonus-ads-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .bonus-ad-slot { width: 100%; height: 150px; background: #000; border: 1px dashed #334155; display: flex; align-items: center; justify-content: center; color: #555; font-size: 0.7rem; cursor: pointer; position: relative; overflow: hidden; border-radius: 8px; }
        .bonus-ad-slot:hover { border-color: var(--accent-color); }
        .bonus-ad-slot img { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; }
        .bonus-ad-slot:hover img { opacity: 1; }
        .ad-overlay-text { position: absolute; z-index: 2; background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 4px; pointer-events: none; }

        /* Double Bonus Popup Modification */
        #double-bonus-modal .popup-content { background: #1e293b; border: 1px solid var(--accent-color); }
        .double-bonus-ads-area { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .db-ad-box { background: #000; border: 1px dashed #555; height: 120px; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; overflow: hidden; }
        .db-ad-box:hover { border-color: var(--success); }
        .db-ad-box img { width: 100%; height: 100%; object-fit: cover; }
        .db-instruction { font-size: 0.95rem; margin-bottom: 10px; color: var(--text-color); line-height: 1.5; }
        .db-processing { display: none; text-align: center; color: var(--accent-color); font-weight: bold; }
        .db-processing.active { display: block; }
        .db-ads-container.hidden { display: none; }

        /* =========================================
           NEW: PROFESSIONAL BETTING SYSTEM (1xBET STYLE)
           ========================================= */
        #betting-modal .popup-content { background: var(--bet-dark); border: 1px solid #333; max-width: 450px; padding: 0; display: flex; flex-direction: column; height: 80vh; }
        .betting-header { background: #1e1e1e; padding: 15px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .betting-header h3 { color: var(--bet-green); font-size: 1.1rem; margin: 0; }
        .close-bet-btn { color: #fff; background: none; border: none; font-size: 1.2rem; cursor: pointer; }
        .betting-body { flex: 1; overflow-y: auto; padding: 10px; background: #121212; }
        .sport-tab { display: inline-block; padding: 8px 16px; background: #2c2c2c; color: #fff; border-radius: 4px; margin-right: 5px; font-size: 0.8rem; font-weight: bold; cursor: pointer; }
        .sport-tab.active { background: var(--bet-green); color: #000; }
        .match-card { background: #1e1e1e; border-radius: 8px; padding: 12px; margin-bottom: 10px; border: 1px solid #333; }
        .match-live-tag { background: var(--danger); color: white; font-size: 0.6rem; padding: 2px 5px; border-radius: 3px; display: inline-block; margin-bottom: 5px; animation: pulse 1.5s infinite; }
        .match-teams { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 0.9rem; font-weight: bold; }
        .match-time { font-size: 0.7rem; color: var(--text-muted); }
        .odds-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
        .odd-btn { background: var(--bet-odd-btn); border: none; padding: 8px; border-radius: 4px; color: #fff; text-align: center; cursor: pointer; transition: background 0.2s; }
        .odd-btn:hover { background: #3a3a3a; }
        .odd-btn.selected { background: var(--bet-green); color: #000; font-weight: bold; box-shadow: 0 0 8px rgba(0, 230, 118, 0.3); }
        .odd-name { font-size: 0.7rem; color: var(--text-muted); display: block; margin-bottom: 2px; }
        .odd-val { font-size: 0.9rem; font-weight: bold; color: var(--bet-green); }
        .odd-btn.selected .odd-val { color: #000; }
        .bet-slip { background: #252525; padding: 15px; border-top: 2px solid var(--bet-green); display: none; }
        .bet-slip.active { display: block; animation: slideUp 0.3s ease; }
        .slip-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; }
        .slip-label { color: #aaa; }
        .slip-val { font-weight: bold; color: #fff; }
        .bet-input-group { display: flex; gap: 10px; margin: 15px 0; }
        .bet-input { flex: 1; background: #121212; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 4px; font-size: 1rem; text-align: right; }
        .bet-input:focus { outline: none; border-color: var(--bet-green); }
        .place-bet-btn { width: 100%; background: var(--bet-green); color: #000; border: none; padding: 12px; border-radius: 4px; font-size: 1rem; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .place-bet-btn:disabled { background: #555; cursor: not-allowed; }
        .match-live-status { text-align: center; padding: 20px; display: none; }
        .match-live-status.active { display: block; }
        .live-loader { border: 4px solid #333; border-top: 4px solid var(--bet-green); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* =========================================
           SUPPORT TICKET STYLES
           ========================================= */
        .ticket-form { padding: 10px; }
        .ticket-form .form-group { margin-bottom: 15px; }
        .contact-links { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .contact-link { display: flex; align-items: center, gap: 10px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px; color: white; text-decoration: none; transition: background 0.3s; }
        .contact-link:hover { background: rgba(255,255,255,0.1); }
        .contact-icon { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1rem; }
        .email-icon { background: #ea4335; }
        .telegram-icon { background: #0088cc; }
        .facebook-icon { background: #1877F2; }
        .ticket-icon { background: var(--success); }
        .contact-text { flex: 1; font-size: 0.8rem; }
        .contact-text strong { display: block; font-size: 0.9rem; }
        .ticket-history { max-height: 200px; overflow-y: auto; margin-top: 15px; }
        .ticket-item { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; margin-bottom: 8px; font-size: 0.8rem; }
        .ticket-subject { font-weight: bold; color: var(--primary-color); }
        .ticket-date { font-size: 0.7rem; color: var(--text-muted); }
        .ticket-status { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; margin-top: 5px; }
        .status-open { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .status-closed { background: rgba(107, 114, 128, 0.2); color: #9ca3af; }
        .status-pending { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }

        /* =========================================
           NEW: LIVE CHAT BUTTON & MODAL STYLES
           ========================================= */
        .chat-fab {
            position: fixed;
            bottom: 180px; /* Above the footer ad (160px + 20px gap) */
            right: 20px;
            width: 60px;
            height: 60px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            cursor: pointer;
            z-index: 100;
            transition: transform 0.3s, background 0.3s;
            animation: bounceIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .chat-fab:hover { transform: scale(1.1); background: var(--secondary-color); }
        @keyframes bounceIn { from { opacity: 0; transform: scale(0.3); } to { opacity: 1; transform: scale(1); } }

        /* Chat Modal (Custom z-index to be above everything) */
        #chat-modal { z-index: 2500; }
        
        .chat-box {
            background: var(--card-bg);
            width: 90%; max-width: 400px;
            height: 80vh; max-height: 600px;
            border-radius: 15px;
            display: flex; flex-direction: column;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            overflow: hidden;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .chat-header {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            color: white;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .chat-body {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chat-bubble {
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 80%;
            font-size: 0.9rem;
            line-height: 1.4;
            position: relative;
            word-wrap: break-word;
        }
        
        .chat-admin { 
            background: rgba(255,255,255,0.1); 
            align-self: flex-start; 
            border-bottom-left-radius: 2px; 
            color: #ddd; 
            border: 1px solid rgba(255,255,255,0.05);
        }
        
        .chat-user { 
            background: var(--primary-color); 
            align-self: flex-end; 
            border-bottom-right-radius: 2px; 
            color: #fff; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .chat-ad-area {
            padding: 8px;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            border-top: 1px solid #333;
            border-bottom: 1px solid #333;
            min-height: 60px;
            color: #555;
            font-size: 0.8rem;
            text-align: center;
            flex-shrink: 0;
            position: relative;
        }
        .chat-ad-placeholder-text {
            position: absolute;
            z-index: 1;
            background: rgba(0,0,0,0.5);
            padding: 2px 5px;
            border-radius: 4px;
            pointer-events: none;
        }

        .chat-footer {
            padding: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            gap: 10px;
            background: var(--card-bg);
            flex-shrink: 0;
        }

        .chat-input {
            flex: 1;
            background: rgba(0,0,0,0.2);
            border: 1px solid #444;
            padding: 10px 15px;
            border-radius: 20px;
            color: white;
            outline: none;
            font-size: 0.9rem;
        }
        .chat-input:focus { border-color: var(--primary-color); }

        .chat-send-btn {
            background: var(--primary-color);
            border: none;
            width: 40px; height: 40px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }
        .chat-send-btn:hover { background: var(--secondary-color); }
        
        /* =========================================
           NEW: NOTIFICATION SYSTEM STYLES
           ========================================= */
        .notification-bell {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: 0.3s;
        }
        .notification-bell:hover { color: var(--accent-color); }
        .notification-bell .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 0.6rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            border: 2px solid var(--bg-color);
        }
        
        .notif-list-container {
            max-height: 60vh;
            overflow-y: auto;
            text-align: left;
            padding: 10px;
        }
        .notif-item {
            background: rgba(255,255,255,0.05);
            border-left: 4px solid var(--primary-color);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .notif-item.unread {
            background: rgba(0, 210, 255, 0.1);
            border-left-color: var(--accent-color);
        }
        .notif-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-color);
        }
        .notif-body {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }
        .notif-time {
            font-size: 0.7rem;
            color: #64748b;
            text-align: right;
        }
        .no-notif {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
        }

    </style>
</head>
<body>

    <div id="toast" class="toast">মেসেজ এখানে দেখাবে</div>

    <!-- Auth Section -->
    <section id="auth-section" class="auth-container">
        <div id="login-form" class="auth-box fade-in">
            <div class="auth-header"><h2><i class="fas fa-coins"></i> Earning App</h2></div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group"><label>ফোন নাম্বার</label><input type="tel" id="login-phone" class="form-control" placeholder="01XXXXXXXXX" required></div>
                <div class="form-group"><label>পাসওয়ার্ড</label><input type="password" id="login-pass" class="form-control" placeholder="******" required></div>
                <button type="submit" class="btn btn-primary" id="login-btn">লগইন করুন</button>
            </form>
            <div class="switch-auth">একাউন্ট নেই? <span onclick="toggleAuth('register')">রেজিস্টার করুন</span></div>
        </div>
        <div id="register-form" class="auth-box hidden">
            <div class="auth-header"><h2><i class="fas fa-user-plus"></i> রেজিস্টার</h2></div>
            <form onsubmit="handleRegister(event)">
                <div class="form-group"><label>আপনার নাম</label><input type="text" id="reg-name" class="form-control" placeholder="নাম লিখুন" required></div>
                <div class="form-group"><label>ফোন নাম্বার</label><input type="tel" id="reg-phone" class="form-control" placeholder="01XXXXXXXXX" required></div>
                <div class="form-group"><label>পাসওয়ার্ড</label><input type="password" id="reg-pass" class="form-control" placeholder="******" required></div>
                <div class="form-group"><label>রেফারেল কোড (ঐচ্ছিক)</label><input type="text" id="reg-ref" class="form-control" placeholder="FSV12345" style="letter-spacing: 1px; text-transform: uppercase;"></div>
               
                <button type="submit" class="btn btn-primary" id="reg-btn">রেজিস্টার করুন</button>
            </form>
            <div class="switch-auth">আগেই একাউন্ট আছে? <span onclick="toggleAuth('login')">লগইন করুন</span></div>
        </div>
    </section>

    <!-- Main App Section -->
    <section id="app-section" class="hidden">
        <div id="app-container">
            <header class="user-header fade-in">
                <div class="user-icon"><i class="fas fa-user"></i></div>
                <div class="user-info">
                    <h3 id="display-name">User Name</h3>
                    <p id="display-phone">01700000000</p>
                    <p>IP: <span id="user-ip" class="ip-badge">Loading...</span></p>
                    <div class="user-balance"><small>বর্তমান ব্যালেন্স</small><br><span class="balance-amount">৳ <span id="display-balance">0.00</span></span></div>
                </div>
                
                <!-- NEW: Notification Bell Icon -->
                <div class="notification-bell" onclick="openNotificationModal()">
                    <i class="fas fa-bell"></i>
                    <span id="notif-count" class="badge hidden">0</span>
                </div>
                
            </header>

            <!-- Header Ads -->
            <script>
  atOptions = {
    'key' : '2be2d10619ffc6c563c3336cde50e020',
    'format' : 'iframe',
    'height' : 90,
    'width' : 728,
    'params' : {}
  };
</script>
<script src="https://beastlyfluke.com/2be2d10619ffc6c563c3336cde50e020/invoke.js"></script>

            <div class="menu-grid fade-in">
                <!-- Daily Bonus Button -->
                <div class="menu-item" onclick="openDailyBonusModal()">
                    <div class="menu-icon" style="color: #f472b6;"><i class="fas fa-gift"></i></div>
                    <div class="menu-title">ডেইলি বোনাস</div>
                </div>
                
                <!-- REPLACED: Betting Button (Instead of Scratch) -->
                <div class="menu-item" onclick="openBettingModal()">
                    <div class="menu-icon" style="color: var(--bet-green);"><i class="fas fa-futbol"></i></div>
                    <div class="menu-title">বেটিং জোন</div>
                </div>

                <div class="menu-item" onclick="openSpinModal()">
                    <div class="menu-icon" style="color: #ffcc00;"><i class="fas fa-dharmachakra"></i></div>
                    <div class="menu-title">ডেইলি ফ্রি স্পিন</div>
                </div>
                <div class="menu-item" onclick="openDailyTaskModal()">
                    <div class="menu-icon" style="color: #22c55e;"><i class="fas fa-briefcase"></i></div>
                    <div class="menu-title">ডেইলি কাজ</div>
                </div>
                <div class="menu-item" onclick="openMyMembership()"><div class="menu-icon" style="color: #3a7bd5;"><i class="fas fa-crown"></i></div><div class="menu-title">মেম্বারশিপ</div></div>
                <div class="menu-item" onclick="openReferralModal()"><div class="menu-icon" style="color: #ef4444;"><i class="fas fa-users"></i></div><div class="menu-title">রেফারেল</div></div>
               
                <!-- WITHDRAWAL BUTTON -->
                <div class="menu-item" onclick="openWithdrawModal()" style="grid-column: span 2;"><div class="menu-icon" style="color: #d946ef;"><i class="fas fa-money-bill-wave"></i></div><div class="menu-title">ঢাকা উত্তোলন</div></div>
               
                <!-- ADD MONEY BUTTON -->
                <div class="menu-item" onclick="openAddMoneyModal()">
                    <div class="menu-icon" style="color: #10b981;"><i class="fas fa-wallet"></i></div>
                    <div class="menu-title">অ্যাড মানি</div>
                </div>

                <!-- Support Ticket Button (Menu Item, not Sidebar) -->
                <div class="menu-item" onclick="openSupportTicketModal()">
                    <div class="menu-icon" style="color: #6366f1;"><i class="fas fa-headset"></i></div>
                    <div class="menu-title">সাপোর্ট টিকেট</div>
                </div>
            </div>

            <div class="live-feed-container fade-in">
                <div class="live-feed-header"><h4>সাম্প্রতিক উত্তোলন</h4><div class="live-indicator"><div class="dot"></div> LIVE</div></div>
                <div id="feed-list"></div>
            </div>
            
        </div>
        <div style="width:300px;height:50px;background:#333;margin:5px auto;display:flex;align-items:center;justify-content:center;border:1px dashed #555;">
            <script>
      atOptions = {
        'key' : '11fe7a09fdcae51f623bce817f755917',
        'format' : 'iframe',
        'height' : 60,
        'width' : 468,
        'params' : {}
      };
    </script>
    <script src="https://beastlyfluke.com/11fe7a09fdcae51f623bce817f755917/invoke.js"></script>
		<div data-mndazid="8542d019-e2f4-4489-be13-592d31e54314"></div>
			</div>
		</div>

    <!-- Welcome Popup -->
    <div id="welcome-popup" class="popup-overlay hidden">
        <div class="popup-content">
            <h3><i class="fas fa-shield-alt"></i> জরুরী নোটিশ</h3>
            <p>আসসালামুয়ালাইকুম প্রিয় ইউজার, এই অ্যাপসটি 100% রিয়েল এবং বিশ্বস্ত আপনারা নিশ্চিন্তে এই অ্যাপসে সততার সাথে কাজ করবেন এবং অবশ্যই <b>VPN</b> ইন্সটল করে <b>USA</b> সার্ভার কানেক্ট করে নিবেন।</p>
            <button class="btn btn-primary" onclick="closePopup()">ঠিক আছে, বুঝেছি</button>
        </div>
    </div>
    
    <!-- NEW: NOTIFICATION MODAL -->
    <div id="notification-modal" class="popup-overlay hidden">
        <div class="popup-content" style="max-width: 420px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="color: var(--accent-color);"><i class="fas fa-bell"></i> নোটিফিকেশন</h3>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeNotificationModal()"></i>
            </div>
            <div id="notification-list" class="notif-list-container">
                <!-- Notifications will load here -->
            </div>
        </div>
    </div>

    <!-- SPIN WHEEL MODAL -->
    <div id="spin-modal" class="popup-overlay hidden">
        <div class="popup-content" id="spin-modal-content">
            <h3 style="color: var(--accent-color); text-transform: uppercase; margin-bottom: 15px;">লাকি স্পিন হুইল</h3>
            <div class="wheel-wrapper">
                <div class="wheel-arrow"></div>
                <div class="wheel-border">
                    <div class="wheel-inner" id="wheel-inner"><div class="wheel-lines"></div></div>
                </div>
                <div class="wheel-center"></div>
            </div>
            <button id="spin-btn" class="spin-btn" onclick="startSpin()">স্পিন করুন</button>
            <div id="spin-timer" class="timer-display hidden"></div>
        </div>
    </div>

    <!-- DAILY TASK MODAL -->
    <div id="daily-task-modal" class="popup-overlay hidden">
        <div class="popup-content" style="max-width: 400px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="color: var(--success);">ডেইলি টাস্ক</h3>
                <i class="fas fa-times" style="cursor: pointer; font-size: 1.2rem;" onclick="closeDailyTaskModal()"></i>
            </div>
           
            <div class="task-buttons-container">
                <div class="task-category-btn active" id="btn-web" onclick="switchTaskTab('web')">
                    <div class="btn-content"><div class="btn-icon"><i class="fas fa-globe"></i></div><div>ওয়েবসাইট ভিজিট</div></div>
                    <div class="btn-reward">৳৪</div>
                </div>
                <div class="task-category-btn" id="btn-app" onclick="switchTaskTab('app')">
                    <div class="btn-content"><div class="btn-icon"><i class="fab fa-android"></i></div><div>এপ্স ইন্সটল</div></div>
                    <div class="btn-reward">৳৭</div>
                </div>
                <div class="task-category-btn" id="btn-survey" onclick="switchTaskTab('survey')">
                    <div class="btn-content"><div class="btn-icon"><i class="fas fa-poll"></i></div><div>সার্ভে করে আয়</div></div>
                    <div class="btn-reward">৳১০</div>
                </div>
                <div class="task-category-btn" id="btn-mega" onclick="switchTaskTab('mega')">
                    <div class="btn-content"><div class="btn-icon"><i class="fas fa-gem"></i></div><div>মেগা অফার</div></div>
                    <div class="btn-reward">৳২০</div>
                </div>
            </div>
           
            <p style="font-size: 0.7rem; color: var(--text-muted); text-align: center; margin-bottom: 10px;">
                আপনার IP: <span id="task-ip-display" style="color: var(--accent-color);">Loading...</span>
            </p>
           
            <ul id="web-task-list" class="task-list"></ul>
            <ul id="app-task-list" class="task-list hidden"></ul>
            <ul id="survey-task-list" class="task-list hidden"></ul>
            <ul id="mega-task-list" class="task-list hidden"></ul>
        </div>
    </div>

    <!-- =====================================================
         MODIFIED: DOUBLE BONUS POPUP (ADS CLICK SYSTEM)
         ===================================================== -->
    <div id="double-bonus-modal" class="popup-overlay hidden">
        <div class="popup-content">
            <div style="font-size: 3rem; margin-bottom: 10px;">🎁</div>
            <h3 style="color: var(--success);">ডাবল বোনাস!</h3>
            <p id="bonus-msg" style="margin: 10px 0; font-size: 0.9rem;">আপনি ডাবল বোনাস পেতে চাইলে নিচের এডসে ক্লিক করুন</p>
            
            <!-- Two Ad Slots -->
            <div id="db-ads-container" class="double-bonus-ads-area">
                <div class="db-ad-box" onclick="clickDoubleBonusAd(1)">
                    <script>
  atOptions = {
    'key' : '98e61db05f229faec28461c97a5ed68b',
    'format' : 'iframe',
    'height' : 250,
    'width' : 300,
    'params' : {}
  };
</script>
<script src="https://beastlyfluke.com/98e61db05f229faec28461c97a5ed68b/invoke.js"></script>
                </div>
                <div class="db-ad-box" onclick="clickDoubleBonusAd(2)">
                    <div id="frame" style="width: 100%;margin: auto;position: relative; z-index: 99998;">
          <iframe data-aa='2427571' src='//acceptable.a-ads.com/2427571/?size=Adaptive'
                            style='border:0; padding:0; width:70%; height:auto; overflow:hidden;display: block;margin: auto'></iframe>
        </div>
                </div>
            </div>

            <!-- Processing State -->
            <div id="db-processing" class="db-processing">
                <i class="fas fa-spinner fa-spin"></i> এডস ভেরিফাই হচ্ছে...
            </div>

            <button id="claim-double-btn" class="btn hidden" style="background: var(--success); margin-top:15px;" onclick="confirmDoubleBonus()">বোনাস নিন</button>
        </div>
    </div>

    <!-- =====================================================
         NEW: DAILY BONUS MODAL
         ===================================================== -->
    <div id="daily-bonus-modal" class="popup-overlay hidden">
        <div class="popup-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="color: var(--accent-color);">ডেইলি বোনাস</h3>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeDailyBonusModal()"></i>
            </div>
            
            <p style="font-size: 0.9rem; margin-bottom: 15px;">নিচের যেকোনো একটি বিজ্ঞাপনে ক্লিক করে বোনাস ক্লেইম করুন:</p>
            
            <div class="daily-bonus-ads-grid">
                <div class="bonus-ad-slot" onclick="clickBonusAd(1)"><script>
  atOptions = {
    'key' : '98e61db05f229faec28461c97a5ed68b',
    'format' : 'iframe',
    'height' : 250,
    'width' : 300,
    'params' : {}
  };
</script>
<script src="https://beastlyfluke.com/98e61db05f229faec28461c97a5ed68b/invoke.js"></script><span class="ad-overlay-text">ভিজিট করুন</span></div>
                <div class="bonus-ad-slot" onclick="clickBonusAd(2)"><script>
  atOptions = {
    'key' : '11fe7a09fdcae51f623bce817f755917',
    'format' : 'iframe',
    'height' : 60,
    'width' : 468,
    'params' : {}
  };
</script>
<script src="https://beastlyfluke.com/11fe7a09fdcae51f623bce817f755917/invoke.js"></script><span class="ad-overlay-text">ভিজিট করুন</span></div>
                <div class="bonus-ad-slot" onclick="clickBonusAd(3)"><script>
  atOptions = {
    'key' : 'c96abb331102dc2f7c6ef9157a8f3c23',
    'format' : 'iframe',
    'height' : 50,
    'width' : 320,
    'params' : {}
  };
</script>
<script src="https://beastlyfluke.com/c96abb331102dc2f7c6ef9157a8f3c23/invoke.js"></script><span class="ad-overlay-text">ভিজিট করুন</span></div>
                <div class="bonus-ad-slot" onclick="clickBonusAd(4)"><script>
  atOptions = {
    'key' : '2be2d10619ffc6c563c3336cde50e020',
    'format' : 'iframe',
    'height' : 90,
    'width' : 728,
    'params' : {}
  };
</script>
<script src="https://beastlyfluke.com/2be2d10619ffc6c563c3336cde50e020/invoke.js"></script><span class="ad-overlay-text">ভিজিট করুন</span></div>
            </div>
            
            <div id="daily-bonus-timer" style="color: var(--danger); font-size: 0.9rem; margin-top: 10px;"></div>
        </div>
    </div>

    <!-- =====================================================
         NEW: PROFESSIONAL BETTING MODAL (1xBET STYLE)
         ===================================================== -->
    <div id="betting-modal" class="popup-overlay hidden">
        <div class="popup-content">
            <div class="betting-header">
                <h3><i class="fas fa-futbol"></i> স্পোর্টস বেটিং</h3>
                <button class="close-bet-btn" onclick="closeBettingModal()"><i class="fas fa-times"></i></button>
            </div>

            <!-- Tabs -->
            <div style="padding: 10px; background: #1e1e1e; display: flex; overflow-x: auto; gap: 5px;">
                <div class="sport-tab active"><i class="fas fa-futbol"></i> ফুটবল</div>
                <div class="sport-tab"><i class="fas fa-table-tennis"></i> টেনিস</div>
                <div class="sport-tab"><i class="fas fa-basketball-ball"></i> বাস্কেট</div>
                <div class="sport-tab"><i class="fas fa-gamepad"></i> ইস্পোর্টস</div>
            </div>

            <div class="betting-body" id="betting-matches-list">
                <!-- Matches will be injected here by JS -->
            </div>

            <!-- Bet Slip -->
            <div id="bet-slip" class="bet-slip">
                <h4 style="color: #fff; margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px;">বেট স্লিপ</h4>
                
                <div class="slip-row">
                    <span class="slip-label">ম্যাচ:</span>
                    <span class="slip-val" id="slip-match-name">-</span>
                </div>
                <div class="slip-row">
                    <span class="slip-label">সিলেকশন:</span>
                    <span class="slip-val" id="slip-selection">-</span>
                </div>
                <div class="slip-row">
                    <span class="slip-label">অড্স:</span>
                    <span class="slip-val" id="slip-odd" style="color: var(--bet-green);">-</span>
                </div>

                <div class="bet-input-group">
                    <span style="align-self: center; color: #aaa;">৳</span>
                    <input type="number" id="bet-amount-input" class="bet-input" placeholder="টাকার পরিমাণ" oninput="calculatePossibleWin()">
                </div>

                <div class="slip-row" style="margin-bottom: 15px;">
                    <span class="slip-label">সম্ভাব্য জয়:</span>
                    <span class="slip-val" id="possible-win" style="color: var(--accent-color); font-size: 1.1rem;">৳ 0.00</span>
                </div>

                <div id="live-match-status" class="match-live-status">
                    <div class="live-loader"></div>
                    <p>ম্যাচ লাইভ রেজাল্ট হচ্ছে...</p>
                    <p id="match-timer" style="font-size: 1.2rem; font-weight: bold; margin-top: 5px;">5</p>
                </div>

                <button id="place-bet-btn" class="place-bet-btn" onclick="placeBet()">বাজি ধরুন</button>
            </div>
        </div>
    </div>

    <!-- =====================================================
         NEW ADD MONEY MODAL
         ===================================================== -->
    <div id="add-money-modal" class="popup-overlay hidden">
        <div class="popup-content add-money-modal" style="text-align: left;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #10b981;">অ্যাড মানি</h3>
                <i class="fas fa-times" style="cursor: pointer; color: var(--text-muted);" onclick="closeAddMoneyModal()"></i>
            </div>

            <div class="bonus-banner">
                <div class="bonus-badge">🎁 স্পেশাল অফার</div>
                <div class="bonus-title">ডিপোজিট বোনাস!</div>
                <div class="bonus-desc">প্রথম ৫০০ টাকা ডিপোজিট করলেই পান ৫০ টাকা ফ্রি!</div>
            </div>

            <div class="agent-info">
                <div style="font-size: 0.8rem; color: #10b981; margin-bottom: 5px;">পেমেন্ট পাঠান এই নম্বরে:</div>
                <div style="display: flex; align-items: center; justify-content: center;">
                    <span class="agent-number">01700000000</span>
                    <i class="fas fa-copy copy-icon" onclick="showToast('নম্বর কপি হয়েছে!')"></i>
                </div>
                <div style="font-size: 0.7rem; color: #94a3b8; text-align: center; margin-top: 5px;">Personal (bKash/Nagad/Rocket)</div>
            </div>

            <div class="promo-input-group">
                <input type="text" id="promo-code" class="promo-input" placeholder="Promo Code (ঐচ্ছিক)">
                <button class="apply-btn" onclick="applyPromo()">Apply</button>
            </div>
            <div id="promo-msg" style="font-size: 0.7rem; color: var(--success); margin-bottom: 15px; height: 15px;"></div>

            <div class="withdraw-form">
                <div class="form-group">
                    <label>পেমেন্ট মেথড</label>
                    <select id="deposit-method" class="form-control">
                        <option value="bkash">bKash</option>
                        <option value="nagad">Nagad</option>
                        <option value="rocket">Rocket</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>আপনার নম্বার (Sender)</label>
                    <input type="tel" id="sender-number" class="form-control" placeholder="01XXXXXXXXX">
                </div>
                <div class="form-group">
                    <label>টাকার পরিমাণ</label>
                    <input type="number" id="deposit-amount" class="form-control" placeholder="কত টাকা পাঠিয়েছেন?">
                </div>
                <div class="form-group">
                    <label>Transaction ID (TrxID)</label>
                    <input type="text" id="trx-id" class="form-control" placeholder="8JHS... (অবশ্যই দিন)">
                </div>

                <button id="btn-submit-deposit" class="btn btn-primary" style="background: linear-gradient(to right, #10b981, #059669);" onclick="submitDepositRequest()">
                    জমা দিন
                </button>
            </div>

            <div class="history-section">
                <div class="history-title"><span>ডিপোজিট হিস্ট্রি</span></div>
                <div id="deposit-history-list" class="history-list">
                    <div style="text-align: center; padding: 10px; font-size: 0.8rem; color: #666;">কোনো হিস্ট্রি নেই</div>
                </div>
            </div>
        </div>
    </div>

    <!-- =====================================================
         NEW WITHDRAWAL MODAL
         ===================================================== -->
    <div id="withdraw-modal" class="popup-overlay hidden">
        <div class="popup-content" style="text-align: left;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: var(--primary-color);">টাকা উত্তোলন</h3>
                <i class="fas fa-times" style="cursor: pointer; color: var(--text-muted);" onclick="closeWithdrawModal()"></i>
            </div>

            <div class="withdraw-header">
                <div class="withdraw-avail-title">আপনার বর্তমান ব্যালেন্স</div>
                <div class="withdraw-avail-amount">৳ <span id="withdraw-balance-display">0.00</span></div>
            </div>

            <label style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 8px; display: block;">পেমেন্ট মেথড সিলেক্ট করুন</label>
            <div class="payment-methods">
                <div class="pay-method-card method-bkash selected" onclick="selectPaymentMethod('bkash', this)">
                    <i class="fas fa-mobile-alt pay-icon"></i>
                    <span class="pay-name">bKash</span>
                </div>
                <div class="pay-method-card method-nagad" onclick="selectPaymentMethod('nagad', this)">
                    <i class="fas fa-wallet pay-icon"></i>
                    <span class="pay-name">Nagad</span>
                </div>
                <div class="pay-method-card method-rocket" onclick="selectPaymentMethod('rocket', this)">
                    <i class="fas fa-shuttle-van pay-icon"></i>
                    <span class="pay-name">Rocket</span>
                </div>
            </div>

            <div class="withdraw-form">
                <div class="form-group">
                    <label>মোবাইল নাম্বার</label>
                    <input type="tel" id="withdraw-account" class="form-control" placeholder="017XXXXXXXX" maxlength="11">
                </div>
                <div class="form-group">
                    <label>টাকার পরিমাণ</label>
                    <input type="number" id="withdraw-amount" class="form-control" placeholder="উত্তোলনের পরিমাণ লিখুন">
                </div>

                <div class="withdraw-note">
                    <i class="fas fa-info-circle"></i> মিনিমাম উত্তোলন: <span>৳৫০০</span>। প্রসেসিং টাইম ২৪-৪৮ ঘণ্টা।
                </div>

                <button id="btn-submit-withdraw" class="btn btn-primary" onclick="handleWithdrawal()">
                    উত্তোলন করুন
                </button>
            </div>

            <div class="history-section">
                <div class="history-title">
                    <span>সাম্প্রতিক উত্তোলন</span>
                    <span style="font-size: 0.7rem; color: var(--accent-color);">History</span>
                </div>
                <div id="withdraw-history-list" class="history-list">
                    <div style="text-align: center; padding: 10px; font-size: 0.8rem; color: #666;">কোনো হিস্ট্রি নেই</div>
                </div>
            </div>
        </div>
    </div>

    <!-- =====================================================
         REFERRAL MODAL
         ===================================================== -->
    <div id="referral-modal" class="popup-overlay hidden">
        <div class="popup-content">
            <div class="ref-header">
                <h3 style="color: var(--primary-color);">রেফার ও আয়</h3>
                <i class="fas fa-times" onclick="closeReferralModal()" style="position: absolute; right: 20px; top: 25px; cursor: pointer; color: var(--text-muted); font-size: 1.2rem;"></i>
            </div>

            <div class="ref-code-box">
                <p style="font-size: 0.8rem; color: var(--text-muted);">আপনার রেফারেল কোড</p>
                <div class="ref-code-display" id="my-ref-code">...</div>
                <div style="display: flex; justify-content: center; gap: 10px;">
                    <button class="copy-btn" onclick="copyRefCode()"><i class="fas fa-copy"></i> কপি কোড</button>
                </div>
                <div style="margin-top: 10px; font-size: 0.7rem; color: #aaa;">বন্ধুদের এই কোড শেয়ার করুন</div>
            </div>

            <div class="qr-placeholder">
                <img id="ref-qr-img" src="" alt="QR Code">
            </div>

            <h4 style="font-size: 0.9rem; margin-bottom: 10px; text-align: center;">শেয়ার করুন:</h4>
            <div class="share-grid">
                <div class="share-item" onclick="shareReferral('whatsapp')"><div class="share-icon-box bg-wa"><i class="fab fa-whatsapp"></i></div><span>WhatsApp</span></div>
                <div class="share-item" onclick="shareReferral('facebook')"><div class="share-icon-box bg-fb"><i class="fab fa-facebook-f"></i></div><span>Facebook</span></div>
                <div class="share-item" onclick="shareReferral('telegram')"><div class="share-icon-box bg-tg"><i class="fab fa-telegram-plane"></i></div><span>Telegram</span></div>
                <div class="share-item" onclick="shareReferral('copy')"><div class="share-icon-box bg-copy"><i class="fas fa-link"></i></div><span>Link</span></div>
            </div>

            <div class="steps-guide">
                <div class="step-item"><div class="step-icon-box"><i class="fas fa-share-alt"></i></div><div class="step-text">কোড শেয়ার</div></div>
                <div class="step-item"><div class="step-icon-box"><i class="fas fa-user-plus"></i></div><div class="step-text">ফ্রেন্ড জয়েন</div></div>
                <div class="step-item"><div class="step-icon-box"><i class="fas fa-check-circle"></i></div><div class="step-text">টাস্ক ও বোনাস</div></div>
            </div>

            <div class="invite-banner" onclick="shareReferral('whatsapp')">
                <div class="invite-text">
                    <h4>Invite friends & earn more!</h4>
                    <p>প্রতি রেফারেলে পান ৳৫ বোনাস</p>
                </div>
                <div class="invite-btn-icon"><i class="fas fa-gift"></i></div>
            </div>
            
            <div style="background: rgba(234, 179, 8, 0.1); border: 1px dashed var(--accent-color); padding: 10px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                <h5 style="color: var(--accent-color); font-size: 0.85rem; margin-bottom: 5px;">🔥 মেগা চ্যালেঞ্জ</h5>
                <p style="font-size: 0.75rem; color: var(--text-color);">২৪ ঘণ্টার মধ্যে ১০ জন রেফার করলে <strong>বোনাস ৳২০০!</strong></p>
                <div id="milestone-progress" style="font-size: 0.7rem; margin-top: 5px; color: var(--text-muted);">চলতি ২৪ঘণ্টা: ০ জন</div>
            </div>

            <div class="stats-grid">
                <div class="stat-card"><div class="stat-val" id="stat-total-ref">0</div><div class="stat-label">মোট রেফার</div></div>
                <div class="stat-card"><div class="stat-val" id="stat-active-ref">0</div><div class="stat-label">একটিভ রেফার</div></div>
                <div class="stat-card"><div class="stat-val">৳<span id="stat-ref-income">0.00</span></div><div class="stat-label">রেফার আয়</div></div>
                <div class="stat-card"><div class="stat-val">৳<span id="stat-withdrawable">0.00</span></div><div class="stat-label">উত্তোলনযোগ্য</div></div>
            </div>

            <div class="leaderboard-section">
                <div class="lb-header">
                    <span>🏆 লিডারবোর্ড (সেরা রেফারার)</span>
                    <span style="font-size: 0.7rem; color: #aaa;">সাপ্তাহিক</span>
                </div>
                <ul id="lb-list" class="lb-list"></ul>
            </div>

            <div class="ref-list-header">আমার রেফারেল লিস্ট</div>
            <div id="referral-list-container" class="referral-scroll-list"></div>

            <div class="ref-rules">
                <strong><i class="fas fa-exclamation-triangle"></i> নিয়মাবলী:</strong><br>
                • ফ্রেন্ড রেজিস্টার করে প্রথম টাস্ক করলে বোনাস আনলক হবে।<br>
                • ফেক একাউন্ট ডিটেক্ট করলে ব্যান হবে।<br>
                • ভিপিএন বা মাল্টিপল একাউন্ট ব্যবহার নিষিদ্ধ।
            </div>

            <div class="withdraw-info-box">
                <strong><i class="fas fa-wallet"></i> উত্তোলন তথ্য:</strong><br>
                • মিনিমাম উত্তোলন: ৳৫০০<br>
                • পেমেন্ট: bKash, Nagad, Rocket<br>
                • প্রসেসিং টাইম: ২৪-৪৮ ঘণ্টা
            </div>

        </div>
    </div>

    <!-- =====================================================
         MEMBERSHIP MODALS
         ===================================================== -->

    <!-- 1. Membership Plans (Shop) -->
    <div id="membership-plans-modal" class="popup-overlay hidden">
        <div class="popup-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="color: var(--primary-color);">মেম্বারশিপ প্ল্যান</h3>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeMembershipPlans()"></i>
            </div>

            <div class="plan-grid">
                <!-- Silver -->
                <div class="plan-card">
                    <div class="plan-header">
                        <div class="plan-name" style="color: #9ca3af;">Silver</div>
                        <div class="plan-price">৳১০০</div>
                    </div>
                    <div class="plan-detail"><span>Validity:</span> <span>15 Days</span></div>
                    <div class="plan-detail"><span>Daily Claim:</span> <span>৳১০ / Day</span></div>
                    <div class="plan-total">Total Possible: ৳১৫০</div>
                    <button class="buy-btn" onclick="initiatePurchase('silver')">Buy Now</button>
                </div>
                <!-- Gold -->
                <div class="plan-card" style="border-color: #ffd700;">
                    <div class="plan-header">
                        <div class="plan-name" style="color: #ffd700;">Gold</div>
                        <div class="plan-price">৳২০০</div>
                    </div>
                    <div class="plan-detail"><span>Validity:</span> <span>30 Days</span></div>
                    <div class="plan-detail"><span>Daily Claim:</span> <span>৳২৫ / Day</span></div>
                    <div class="plan-total">Total Possible: ৳৭৫০</div>
                    <button class="buy-btn" onclick="initiatePurchase('gold')" style="background: linear-gradient(45deg, #ffd700, #f59e0b); color: #000;">Buy Now</button>
                </div>
                <!-- VIP -->
                <div class="plan-card vip">
                    <div class="plan-header">
                        <div class="plan-name" style="color: var(--accent-color);">VIP</div>
                        <div class="plan-price">৳৫০০</div>
                    </div>
                    <div class="plan-detail"><span>Validity:</span> <span>30 Days</span></div>
                    <div class="plan-detail"><span>Daily Claim:</span> <span>৳৮০ / Day</span></div>
                    <div class="plan-total">Total Possible: ৳২৪০০</div>
                    <button class="buy-btn" onclick="initiatePurchase('vip')" style="background: var(--accent-color); color: #000;">Buy Now</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. Payment/Confirmation Modal -->
    <div id="payment-modal" class="popup-overlay hidden">
        <div class="popup-content">
            <h3 style="margin-bottom: 15px;">পেমেন্ট কনফার্মেশন</h3>
            <div class="payment-summary">
                <div class="payment-row"><span>Selected Plan:</span> <span id="pay-plan-name" style="font-weight: bold;">Silver</span></div>
                <div class="payment-row"><span>Validity:</span> <span id="pay-validity">15 Days</span></div>
                <div class="payment-row"><span>Daily Income:</span> <span id="pay-daily">৳১০</span></div>
                <div class="payment-total"><span>Total Price:</span> <span id="pay-price">৳১০০</span></div>
            </div>
           
            <p style="font-size: 0.8rem; margin-bottom: 15px;">
                Wallet Balance: ৳<span id="pay-wallet-bal">0.00</span>
            </p>

            <button id="confirm-pay-btn" class="btn btn-primary" onclick="confirmPurchase()">Pay Now</button>
            <button class="btn close-small-btn" onclick="closePaymentModal()">Cancel</button>
           
            <div style="margin-top: 15px; font-size: 0.7rem; color: #aaa;">
                Payment Methods: bKash, Nagad, Rocket (Automated via Wallet)
            </div>
        </div>
    </div>

    <!-- 3. My Membership Dashboard -->
    <div id="my-membership-modal" class="popup-overlay hidden">
        <div class="popup-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3>মাই মেম্বারশিপ</h3>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeMyMembership()"></i>
            </div>

            <div id="membership-active-view">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px;">
                    <div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">Current Plan</div>
                        <div style="font-weight: bold; color: var(--primary-color);" id="dash-plan-name">No Active Plan</div>
                    </div>
                    <div id="dash-status-badge" class="membership-status-badge" style="display:none;">Active</div>
                </div>

                <div id="plan-details" class="hidden">
                    <div class="plan-detail"><span>Start Date:</span> <span id="dash-start">-</span></div>
                    <div class="plan-detail"><span>End Date:</span> <span id="dash-end">-</span></div>
                    <div class="plan-detail"><span>Days Left:</span> <span id="dash-days-left" style="color: var(--accent-color);">0</span></div>
                    <div class="plan-detail"><span>Daily Amount:</span> <span id="dash-daily">৳০</span></div>
                    <div class="plan-detail" style="margin-bottom: 10px;"><span>Total Claimed:</span> <span id="dash-total-claimed">৳০</span></div>

                    <div class="claim-section">
                        <h4 style="margin-bottom: 10px;">ডেইলি ইনকাম ক্লেইম করুন</h4>
                        <button id="claim-income-btn" class="claim-btn-large" onclick="claimDailyIncome()">
                            <i class="fas fa-hand-holding-usd"></i> Claim ৳<span id="claim-amount-btn">0</span>
                        </button>
                        <div id="claim-timer" class="claim-timer hidden">Next claim in: 23:59:59</div>
                    </div>
                </div>

                <div id="buy-plan-cta" style="text-align: center; padding: 30px 0;">
                    <i class="fas fa-crown" style="font-size: 3rem; color: #334155; margin-bottom: 10px;"></i>
                    <p style="margin-bottom: 20px;">আপনার কোনো মেম্বারশিপ নেই।</p>
                    <button class="btn btn-primary" onclick="closeMyMembership(); openMembershipPlans()">প্ল্যান দেখুন</button>
                </div>
            </div>

            <div style="margin-top: 25px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                <h4 style="font-size: 0.9rem; margin-bottom: 10px;">ক্লেইম হিস্ট্রি</h4>
                <div id="claim-history-list" class="history-list"></div>
            </div>

            <div class="policy-text">
                <strong>মেম্বারশিপ পলিসি:</strong><br>
                • একবার ক্রয় করলে টাকা ফেরত দেওয়া হবে না (Non-refundable)।<br>
                • প্রতি দিন একবার ক্লেইম করা যাবে।<br>
                • মেম্বারশিপ এক্সপায়ার্ড হলে ক্লেইম বন্ধ।<br>
                • কোম্পানি যেকোনো সময় নিয়ম পরিবর্তন করতে পারে।
            </div>
        </div>
    </div>

    <!-- =====================================================
         IN-APP BROWSER MODAL
         ===================================================== -->
    <div id="in-app-browser" class="in-app-browser-overlay hidden">
        <div class="browser-sidebar">
            <div class="sidebar-close-btn" onclick="closeInAppBrowser(false)">
                <i class="fas fa-times"></i>
            </div>
            
            <div class="sidebar-ad sidebar-ad-top" onclick="showToast('বিশেষ অফার! ক্লিক করুন বিস্তারিত জানতে')">
                <i class="fas fa-gift"></i>
                <div>বিশেষ অফার!</div>
                <div style="font-size: 0.5rem; margin-top: 5px;">ক্লিক করুন</div>
            </div>
            
            <div class="timer-container" id="timer-container-default">
                <i class="fas fa-hourglass-half timer-icon"></i>
                <div class="timer-circle" id="browser-timer">20</div>
                <div class="timer-label">টাইম বাকি<br>Wait</div>
            </div>
            
            <div class="sidebar-ad sidebar-ad-bottom" onclick="showToast('নতুন ব্যবহারকারীর জন্য ৳১০০ বোনাস!')">
                <i class="fas fa-coins"></i>
                <div>৳১০০ বোনাস!</div>
                <div style="font-size: 0.5rem; margin-top: 5px;">নতুন ইউজার</div>
            </div>
        </div>
        
        <div class="right-sidebar-ad" onclick="showToast('রেফারেল বোনাস ৳২০০ পেতে এখনই ক্লিক করুন!')">
            <i class="fas fa-users"></i>
            <div>রেফারেল বোনাস</div>
            <div style="font-size: 0.7rem; font-weight: bold;">৳২০০</div>
            <div style="font-size: 0.5rem; margin-top: 5px;">ক্লিক করুন</div>
        </div>
        
        <div class="browser-view">
            <div class="browser-header">
                <i class="fas fa-lock" style="color: #22c55e; font-size: 0.8rem;"></i>
                <div class="browser-address" id="browser-url-display">Loading...</div>
            </div>
            <iframe id="browser-iframe" class="browser-frame" src="about:blank"></iframe>
            <div id="iframe-error" class="iframe-error-msg"></div>
        </div>
    </div>

    <!-- =====================================================
         সাপোর্ট টিকেট মোডাল
         ===================================================== -->
    <div id="support-ticket-modal" class="popup-overlay hidden">
        <div class="popup-content" style="max-width: 420px; text-align: left;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="color: var(--primary-color);">সাপোর্ট টিকেট</h3>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeSupportTicketModal()"></i>
            </div>
            
            <div class="ticket-form">
                <div class="form-group">
                    <label>বিষয়</label>
                    <input type="text" id="ticket-subject" class="form-control" placeholder="আপনার সমস্যার বিষয় লিখুন">
                </div>
                <div class="form-group">
                    <label>বিস্তারিত বর্ণনা</label>
                    <textarea id="ticket-message" class="form-control" rows="4" placeholder="সমস্যাটির বিস্তারিত বর্ণনা লিখুন..."></textarea>
                </div>
                <button class="btn btn-primary" onclick="submitSupportTicket()">টিকেট সাবমিট করুন</button>
            </div>
            
            <div class="contact-links">
                <h4 style="font-size: 0.9rem; margin: 20px 0 10px 0;">সরাসরি যোগাযোগ</h4>
                
                <a href="mailto:turkey228499@gmail.com" class="contact-link" target="_blank">
                    <div class="contact-icon email-icon"><i class="fas fa-envelope"></i></div>
                    <div class="contact-text"><strong>ইমেইল</strong>turkey228499@gmail.com</div>
                </a>
                
                <a href="https://t.me/chat2mee" class="contact-link" target="_blank">
                    <div class="contact-icon telegram-icon"><i class="fab fa-telegram"></i></div>
                    <div class="contact-text"><strong>টেলিগ্রাম</strong>t.me/chat2mee</div>
                </a>
                
                <a href="https://facebook.com/love2islam" class="contact-link" target="_blank">
                    <div class="contact-icon facebook-icon"><i class="fab fa-facebook"></i></div>
                    <div class="contact-text"><strong>ফেসবুক</strong>facebook.com/love2islam</div>
                </a>
            </div>
            
            <div style="margin-top: 20px;">
                <h4 style="font-size: 0.9rem; margin-bottom: 10px;">আপনার টিকেট সমূহ</h4>
                <div id="ticket-history" class="ticket-history">
                    <div style="text-align: center; padding: 15px; color: #666; font-size: 0.8rem;">কোন টিকেট খুঁজে পাওয়া যায়নি</div>
                </div>
            </div>
        </div>
    </div>

    <!-- =====================================================
         NEW: LIVE CHAT MODAL & BUTTON
         ===================================================== -->
    <!-- Chat Floating Button -->
    <div id="chat-btn" class="chat-fab" onclick="toggleChat()">
        <i class="fas fa-comments"></i>
    </div>

    <!-- Chat Modal -->
    <div id="chat-modal" class="popup-overlay hidden">
        <div class="chat-box">
            <div class="chat-header">
                <span><i class="fas fa-headset"></i> সাপোর্ট চ্যাট</span>
                <i class="fas fa-times" style="cursor: pointer;" onclick="toggleChat()"></i>
            </div>
            
            <div class="chat-body" id="chat-body">
                <div class="chat-bubble chat-admin">
                    আসসালামুয়ালাইকুম! আমি কিভাবে আপনাকে সাহায্য করতে পারি?
                </div>
            </div>
            
            <!-- Ad Space Inside Chat -->
            <div class="chat-ad-area">
                <span class="chat-ad-placeholder-text">বিজ্ঞাপন</span>
                <script>
  atOptions = {
    'key' : '11fe7a09fdcae51f623bce817f755917',
    'format' : 'iframe',
    'height' : 60,
    'width' : 468,
    'params' : {}
  };
</script>
<script src="https://beastlyfluke.com/11fe7a09fdcae51f623bce817f755917/invoke.js"></script>
            </div>
            
            <div class="chat-footer">
                <input type="text" id="chat-input" class="chat-input" placeholder="মেসেজ লিখুন..." onkeypress="handleChatEnter(event)">
                <button class="chat-send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script>
        // --- FIREBASE INITIALIZATION ---
        if (!firebase.apps.length) {
            firebase.initializeApp({
                apiKey: "AIzaSyDEFmlb1z_XywhJs_HFhFyECu0WNIQ5NyE",
                authDomain: "eanrtaka.firebaseapp.com",
                databaseURL: "https://eanrtaka-default-rtdb.firebaseio.com",
                projectId: "eanrtaka",
                storageBucket: "eanrtaka.firebasestorage.app",
                messagingSenderId: "49744195787",
                appId: "1:49744195787:web:3439970d0acddbce84eb4e",
                measurementId: "G-HZ3NECKG9Y"
            });
        }
        
        const db = firebase.database();

        // --- GLOBAL STATE ---
        let currentUser = null;
        let currentUserPhone = localStorage.getItem('ea_currentPhone') || null;
        let currentUserListener = null;
        let selectedWithdrawMethod = 'bkash';
        
        const SPIN_COOLDOWN = 12 * 60 * 60 * 1000;
        const SPIN_REWARD = 5;
        const WEB_REWARD = 4;
        const APP_REWARD = 7;
        const SURVEY_REWARD = 10;
        const MEGA_REWARD = 20;
        const REFERRAL_REWARD = 5;
        const MIN_WITHDRAW = 500;
        
        const DAILY_BONUS_REWARD = 10;
        const DAILY_BONUS_COOLDOWN = 24 * 60 * 60 * 1000;
        const REFERRAL_MILESTONE_COUNT = 10;
        const REFERRAL_MILESTONE_REWARD = 200;
       
        const WEB_TASK_DURATION = 20;
        const APP_TASK_DURATION = 15;
        const SURVEY_TASK_DURATION = 30;
        const MEGA_TASK_DURATION = 60;

        // Betting Variables
        let currentBet = { matchId: null, matchName: null, selection: null, odd: 0, amount: 0 };
        let bettingMatches = [
            { id: 1, teamA: 'Brazil', teamB: 'Argentina', live: true, time: '45\'', odds: { '1': 2.10, 'X': 3.20, '2': 1.85 } },
            { id: 2, teamA: 'Real Madrid', teamB: 'Barcelona', live: true, time: '78\'', odds: { '1': 1.95, 'X': 3.50, '2': 1.90 } },
            { id: 3, teamA: 'Man City', teamB: 'Liverpool', live: true, time: '12\'', odds: { '1': 1.70, 'X': 3.80, '2': 2.10 } },
            { id: 4, teamA: 'Nadal', teamB: 'Djokovic', live: false, time: 'Today 20:00', odds: { '1': 1.55, 'X': 2.20, '2': 2.50 } }
        ];

        const webTaskLinks = [
            "https://pertlouv.com/3KsDkDJb+vM=?",
            "https://eranurl.blogspot.com/2026/02/blog-post.html#?o=90958b17ab0b13382f25df2b6de404fb152c78448fa7fff81fbcaa12647a361748e14543b8b1bd9640fb08da9478c88420f633eaad0af967742760742ddac139062a35c34f6b4b92b51ecad1446245db1b06ae0ff87c53a7",
            "https://screative101.blogspot.com/2026/02/blog-post_11.html",
            "https://beastlyfluke.com/vfcsh4wxq?key=8eb65bc7000855b083e1ef85d29cdd26",
            "https://bd-voting.vercel.app/"
        ];
        const appInstallLinks = [
            "https://affizer.g2afse.com/sl?id=673e05e79ec786ee35734f69&pid=5829",
            "https://earning-pro-phi.vercel.app",
            "https://getafilenow.com/1869987",
            "https://beastlyfluke.com/ddms9ahej?key=4ffdcd734180fd058665b27fc8c764ad",
            "https://data527.click/9f9ac686c24a956e8f25/f97f728f8f/?placementName=default"
        ];
        const surveyTaskLinks = [
            "https://omg10.com/4/9483568",
            "https://smrturl.co/7fa31a2",
            "https://www.cdndn.com/list/b5DM1yNC"
        ];
        const megaTaskLinks = [
            "https://screative101.blogspot.com/p/mega-offer.html"
        ];

        const MEMBERSHIP_PLANS = {
            silver: { name: 'Silver', price: 100, days: 15, daily: 10 },
            gold: { name: 'Gold', price: 200, days: 30, daily: 25 },
            vip: { name: 'VIP', price: 500, days: 30, daily: 80 }
        };
        let selectedPlanType = null;
        let membershipTimerInterval = null;
        let currentRotation = 0;
        let activeTaskIndex = null;
        let activeTaskTimer = null;
        let bonusType = 'spin';
        let bonusTaskIndex = -1;
        let isMegaOfferCompleted = false;
        let doubleBonusPendingAmount = 0; // Store amount waiting for ad click
       
        function generateRefCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let result = 'FSV';
            for (let i = 0; i < 5; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function toggleAuth(view) {
            if (view === 'register') {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('register-form').classList.remove('hidden');
                document.getElementById('register-form').classList.add('fade-in');
            } else {
                document.getElementById('register-form').classList.add('hidden');
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('login-form').classList.add('fade-in');
            }
        }

        // --- AUTH FUNCTIONS ---
        
        async function handleRegister(e) {
            e.preventDefault();
            const btn = document.getElementById('reg-btn');
            const originalText = btn.innerText;
            
            const name = document.getElementById('reg-name').value.trim();
            const phone = document.getElementById('reg-phone').value.trim();
            const pass = document.getElementById('reg-pass').value.trim();
            const refInput = document.getElementById('reg-ref').value.trim().toUpperCase();

            if(name.length < 2) { showToast('সঠিক নাম দিন।'); return; }
            const bdPhoneRegex = /^01[3-9]\d{8}$/;
            if (!bdPhoneRegex.test(phone)) { showToast('সঠিক বাংলাদেশী ফোন নাম্বার দিন (01XXXXXXXXX)।'); return; }
            if(pass.length < 6) { showToast('পাসওয়ার্ড কমপক্ষে 6 ডিজিটের হতে হবে।'); return; }

            btn.disabled = true;
            btn.innerText = 'প্রসেসিং...';

            try {
                const userIp = await getUserIP();
                const ipSnapshot = await db.ref('users').orderByChild('ip').equalTo(userIp).once('value');
                if (ipSnapshot.exists()) {
                    showToast('এই IP দিয়ে ইতিমধ্যে একটি একাউন্ট খোলা হয়েছে! এক IP থেকে একবারই রেজিস্ট্রেশন করা যাবে।');
                    btn.disabled = false; btn.innerText = originalText; return;
                }

                const phoneSnapshot = await db.ref('users').orderByChild('phone').equalTo(phone).once('value');
                if (phoneSnapshot.exists()) { showToast('এই নম্বর দিয়ে ইতিমধ্যে একাউন্ট খোলা হয়েছে!'); btn.disabled = false; btn.innerText = originalText; return; }

                let referredBy = null;
                let initialBonus = 100;

                if (refInput) {
                    try {
                        const refSnap = await db.ref('users').orderByChild('referralCode').equalTo(refInput).once('value');
                        if (refSnap.exists()) {
                            const referrerData = Object.values(refSnap.val())[0];
                            referredBy = referrerData.phone;
                            initialBonus += 200;
                        } else { showToast('রেফারেল কোডটি সঠিক নয়! রেজিস্টার হচ্ছে রেফারেল ছাড়া।'); }
                    } catch (err) { console.error("Ref check error:", err); }
                }

                let myRefCode = generateRefCode();

                const newUser = {
                    name, phone, pass, balance: initialBonus, lastSpin: 0, lastDailyBonus: 0,
                    referralMilestoneClaimed: false, referralTimestamps: [],
                    dailyWebTasks: [true, true, true, true, true], dailyAppTasks: [true, true, true, true, true],
                    dailySurveyTasks: [true, true, true], dailyMegaTasks: [true], lastTaskDate: null,
                    ip: userIp, joined: new Date().toISOString(), referralCode: myRefCode, referredBy: referredBy,
                    refStats: { totalReferrals: 0, activeReferrals: 0, totalIncome: 0.00, withdrawableRefBalance: 0.00, referredUsers: [] },
                    membership: null, withdrawals: [], deposits: [], supportTickets: []
                };
               
                await db.ref('users/' + phone).set(newUser);
                console.log("User Registered:", phone);

                if (referredBy) {
                    const refUpdate = {};
                    refUpdate[`users/${referredBy}/refStats/referredUsers/${Date.now()}`] = { phone: phone, name: name, joinedDate: new Date().toISOString(), status: 'invited', earnedFromThis: 0.00 };
                    db.ref('users/' + referredBy + '/referralTimestamps').push(Date.now());
                    db.ref('users/' + referredBy + '/refStats/totalReferrals').transaction(count => (count || 0) + 1);
                    checkReferralMilestone(referredBy);
                }

                currentUserPhone = phone;
                localStorage.setItem('ea_currentPhone', phone);
                document.getElementById('register-form').reset();
                btn.disabled = false; btn.innerText = originalText;
                listenToUser(phone);
                showToast(`রেজিস্ট্রেশন সফল! বোনাস হিসেবে ${initialBonus} টাকা পেয়েছেন।`);

            } catch (error) {
                console.error("Registration Error:", error);
                showToast('সংযোগ সমস্যা হয়েছে। আবার চেষ্টা করুন।');
                btn.disabled = false; btn.innerText = originalText;
            }
        }

        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (e) { return "Error"; }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const btn = document.getElementById('login-btn');
            const originalText = btn.innerText;

            const phone = document.getElementById('login-phone').value.trim();
            const pass = document.getElementById('login-pass').value.trim();

            if(phone.length < 11 || pass.length < 1) { showToast('ফোন নাম্বার এবং পাসওয়ার্ড দিন।'); return; }

            btn.disabled = true; btn.innerText = 'লগইন হচ্ছে...';

            try {
                const snapshot = await db.ref('users').orderByChild('phone').equalTo(phone).once('value');
                if (snapshot.exists()) {
                    const users = snapshot.val();
                    const userKey = Object.keys(users)[0];
                    const user = users[userKey];
                    if (user.pass === pass) {
                        currentUserPhone = phone;
                        localStorage.setItem('ea_currentPhone', phone);
                        if(!user.withdrawals) await db.ref('users/' + phone + '/withdrawals').set([]);
                        if(!user.deposits) await db.ref('users/' + phone + '/deposits').set([]);
                        if(!user.supportTickets) await db.ref('users/' + phone + '/supportTickets').set([]);
                        listenToUser(phone);
                    } else { showToast('ভুল পাসওয়ার্ড!'); btn.disabled = false; btn.innerText = originalText; }
                } else { showToast('এই নম্বরে কোনো একাউন্ট পাওয়া যায়নি!'); btn.disabled = false; btn.innerText = originalText; }
            } catch (error) { showToast('ইন্টারনেট সংযোগ চেক করুন।'); btn.disabled = false; btn.innerText = originalText; }
        }

        function listenToUser(phone) {
            if(currentUserListener) db.ref('users/' + currentUserPhone).off();
            currentUserListener = db.ref('users/' + phone);
            currentUserListener.on('value', (snapshot) => {
                currentUser = snapshot.val();
                if(!currentUser) { logout(); return; }
                if(!currentUser.referralCode) { const code = generateRefCode(); db.ref('users/' + phone + '/referralCode').set(code); }
                if(!currentUser.withdrawals) currentUser.withdrawals = [];
                if(!currentUser.deposits) currentUser.deposits = []; 
                if(!currentUser.supportTickets) currentUser.supportTickets = [];
                if(!currentUser.referralTimestamps) currentUser.referralTimestamps = [];
                initAppUI();
            }, (error) => { showToast('ডাটা লোড করতে সমস্যা হচ্ছে।'); });
        }

        function initAppUI() {
            if (!currentUser) return;
            document.getElementById('auth-section').classList.add('hidden');
            document.getElementById('app-section').classList.remove('hidden');
            document.getElementById('display-name').textContent = currentUser.name;
            document.getElementById('display-phone').textContent = currentUser.phone;
            document.getElementById('user-ip').textContent = currentUser.ip || 'Checking...';
            checkMembershipExpiry();
            updateBalanceDisplay();

            const popupShown = sessionStorage.getItem('ea_popup_shown');
            if (!popupShown) { document.getElementById('welcome-popup').classList.remove('hidden'); sessionStorage.setItem('ea_popup_shown', 'true'); }
            checkDailyTaskReset();
            startFakeFeed();
            
            // NEW: Start listening for notifications
            listenForNotifications();
        }
        
        // ==========================================
        // NEW: NOTIFICATION SYSTEM LOGIC
        // ==========================================
        function listenForNotifications() {
            db.ref('notifications').orderByChild('timestamp').limitToLast(20).on('value', (snapshot) => {
                const data = snapshot.val();
                const badge = document.getElementById('notif-count');
                
                if (data) {
                    const count = Object.keys(data).length;
                    badge.textContent = count;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            });
        }

        function openNotificationModal() {
            const modal = document.getElementById('notification-modal');
            const list = document.getElementById('notification-list');
            modal.classList.remove('hidden');
            
            list.innerHTML = '<div style="text-align:center; padding:20px;"><i class="fas fa-spinner fa-spin"></i> লোড হচ্ছে...</div>';

            db.ref('notifications').orderByChild('timestamp').once('value', (snapshot) => {
                const data = snapshot.val();
                list.innerHTML = '';
                
                if (!data) {
                    list.innerHTML = '<div class="no-notif"><i class="fas fa-bell-slash"></i><br>কোনো নোটিফিকেশন নেই</div>';
                    return;
                }

                // Convert to array and reverse to show newest first
                const notifArray = Object.values(data).reverse();

                notifArray.forEach(notif => {
                    const div = document.createElement('div');
                    div.className = 'notif-item';
                    
                    const dateObj = new Date(notif.timestamp);
                    const timeStr = dateObj.toLocaleString('bn-BD');
                    
                    div.innerHTML = `
                        <div class="notif-title">${notif.title || 'অ্যাডমিন বার্তা'}</div>
                        <div class="notif-body">${notif.body || notif.message}</div>
                        <div class="notif-time">${timeStr}</div>
                    `;
                    list.appendChild(div);
                });
            });
        }

        function closeNotificationModal() {
            document.getElementById('notification-modal').classList.add('hidden');
        }

        function logout() {
            localStorage.removeItem('ea_currentPhone');
            currentUser = null; currentUserPhone = null;
            if(currentUserListener) { db.ref('users/' + currentUserPhone).off(); currentUserListener = null; }
            document.getElementById('app-section').classList.add('hidden');
            document.getElementById('auth-section').classList.remove('hidden');
        }

        function updateFirebaseData(path, data) {
            if(!currentUserPhone) return;
            db.ref('users/' + currentUserPhone + '/' + path).set(data).catch(err => console.error("Update Error:", err));
        }

        function updateBalanceDisplay() {
            if(!currentUser) return;
            document.getElementById('display-balance').textContent = currentUser.balance.toFixed(2);
        }

        function closePopup() { document.getElementById('welcome-popup').classList.add('hidden'); }
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        // ==========================================
        // PROFESSIONAL BETTING SYSTEM LOGIC
        // ==========================================
        function openBettingModal() {
            const modal = document.getElementById('betting-modal');
            const list = document.getElementById('betting-matches-list');
            const slip = document.getElementById('bet-slip');
            
            currentBet = { matchId: null, matchName: null, selection: null, odd: 0, amount: 0 };
            slip.classList.remove('active');
            document.getElementById('bet-amount-input').value = '';
            document.getElementById('possible-win').textContent = '৳ 0.00';
            document.getElementById('live-match-status').classList.remove('active');
            document.getElementById('place-bet-btn').style.display = 'block';

            list.innerHTML = '';
            bettingMatches.forEach(match => {
                const div = document.createElement('div');
                div.className = 'match-card';
                div.innerHTML = `
                    ${match.live ? '<span class="match-live-tag">LIVE</span>' : ''}
                    <div class="match-teams">
                        <span>${match.teamA}</span>
                        <span style="color: #666; font-size: 0.8rem;">VS</span>
                        <span>${match.teamB}</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom: 8px;">
                        <span class="match-time">${match.time}</span>
                    </div>
                    <div class="odds-grid">
                        <button class="odd-btn" onclick="selectOdd(${match.id}, '1', ${match.odds['1']}, '${match.teamA} vs ${match.teamB}')">
                            <span class="odd-name">1</span>
                            <span class="odd-val">${match.odds['1']}</span>
                        </button>
                        <button class="odd-btn" onclick="selectOdd(${match.id}, 'X', ${match.odds['X']}, '${match.teamA} vs ${match.teamB}')">
                            <span class="odd-name">X</span>
                            <span class="odd-val">${match.odds['X']}</span>
                        </button>
                        <button class="odd-btn" onclick="selectOdd(${match.id}, '2', ${match.odds['2']}, '${match.teamA} vs ${match.teamB}')">
                            <span class="odd-name">2</span>
                            <span class="odd-val">${match.odds['2']}</span>
                        </button>
                    </div>
                `;
                list.appendChild(div);
            });

            modal.classList.remove('hidden');
        }

        function closeBettingModal() {
            document.getElementById('betting-modal').classList.add('hidden');
        }

        function selectOdd(matchId, selection, odd, matchName) {
            document.querySelectorAll('.odd-btn').forEach(btn => btn.classList.remove('selected'));
            event.currentTarget.classList.add('selected');

            currentBet = { matchId, selection, odd, matchName };
            
            const slip = document.getElementById('bet-slip');
            slip.classList.add('active');
            
            document.getElementById('slip-match-name').textContent = matchName;
            document.getElementById('slip-selection').textContent = selection === '1' ? 'Home Win' : selection === 'X' ? 'Draw' : 'Away Win';
            document.getElementById('slip-odd').textContent = odd.toFixed(2);
            
            calculatePossibleWin();
        }

        function calculatePossibleWin() {
            const amount = parseFloat(document.getElementById('bet-amount-input').value) || 0;
            const possible = amount * currentBet.odd;
            document.getElementById('possible-win').textContent = '৳ ' + possible.toFixed(2);
        }

        function placeBet() {
            const amount = parseFloat(document.getElementById('bet-amount-input').value);
            
            if(!currentBet.matchId) { showToast('দয়া করে একটি অপশন সিলেক্ট করুন।'); return; }
            if(!amount || amount <= 0) { showToast('সঠিক টাকার পরিমাণ দিন।'); return; }
            if(amount > currentUser.balance) { showToast('আপনার ব্যালেন্ডে পর্যাপ্ত টাকা নেই!'); return; }

            currentUser.balance -= amount;
            updateBalanceDisplay();
            updateFirebaseData('balance', currentUser.balance);

            document.getElementById('place-bet-btn').style.display = 'none';
            document.getElementById('live-match-status').classList.add('active');
            document.getElementById('bet-slip').classList.remove('active');

            let timeLeft = 5;
            const timerDisplay = document.getElementById('match-timer');
            timerDisplay.textContent = timeLeft;

            const interval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if(timeLeft <= 0) {
                    clearInterval(interval);
                    resolveBet(amount);
                }
            }, 1000);
        }

        function resolveBet(amount) {
            const isWin = Math.random() < 0.5; 
            
            const statusMsg = isWin ? 'অভিনন্দন! আপনি জিতেছেন।' : 'দুঃখিত, আপনি হেরেছেন।';
            const winAmount = isWin ? (amount * currentBet.odd) : 0;

            if(isWin) {
                currentUser.balance += winAmount;
                updateBalanceDisplay();
                updateFirebaseData('balance', currentUser.balance);
            }

            document.getElementById('live-match-status').innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 10px; color: ${isWin ? 'var(--success)' : 'var(--danger)'}">
                    <i class="fas ${isWin ? 'fa-trophy' : 'fa-times-circle'}"></i>
                </div>
                <h3 style="color: ${isWin ? 'var(--success)' : 'var(--danger)'}">${statusMsg}</h3>
                <p style="font-size: 1.2rem; margin-top: 5px;">${isWin ? 'জয়ের পরিমাণ: ৳' + winAmount.toFixed(2) : ''}</p>
                <button class="btn btn-primary" style="margin-top: 20px;" onclick="closeBettingModal()">বন্ধ করুন</button>
            `;
        }

        // ==========================================
        // NEW DOUBLE BONUS LOGIC (ADS)
        // ==========================================
        function claimDoubleBonus() {
            let amount = 0;
            if (bonusType === 'spin') amount = SPIN_REWARD;
            else if (bonusType === 'web') amount = WEB_REWARD;
            else if (bonusType === 'app') amount = APP_REWARD;
            else if (bonusType === 'survey') amount = SURVEY_REWARD;
            else if (bonusType === 'mega') amount = MEGA_REWARD;

            if (amount <= 0) return;

            doubleBonusPendingAmount = amount;

            const modal = document.getElementById('double-bonus-modal');
            const adsContainer = document.getElementById('db-ads-container');
            const processing = document.getElementById('db-processing');
            const claimBtn = document.getElementById('claim-double-btn');

            adsContainer.classList.remove('hidden');
            processing.classList.remove('active');
            claimBtn.classList.add('hidden');

            modal.classList.remove('hidden');
        }

        function clickDoubleBonusAd(id) {
            const adsContainer = document.getElementById('db-ads-container');
            const processing = document.getElementById('db-processing');
            const claimBtn = document.getElementById('claim-double-btn');

            adsContainer.classList.add('hidden');
            processing.classList.add('active');

            setTimeout(() => {
                processing.classList.remove('active');
                claimBtn.classList.remove('hidden');
                showToast('এডস সম্পন্ন হয়েছে! বোনাস নিন।');
            }, 3000);
        }

        function confirmDoubleBonus() {
            currentUser.balance += doubleBonusPendingAmount;
            updateBalanceDisplay();
            updateFirebaseData('balance', currentUser.balance);

            document.getElementById('double-bonus-modal').classList.add('hidden');
            
            if (bonusType !== 'spin') {
                claimTaskReward(bonusTaskIndex, false, bonusType);
            }
            
            showToast(`ডাবল বোনাস সফল! ৳${doubleBonusPendingAmount} যোগ হয়েছে।`);
            doubleBonusPendingAmount = 0;
        }

        function closeBonusPopup() {
            document.getElementById('double-bonus-modal').classList.add('hidden');
            if (bonusType !== 'spin') {
                claimTaskReward(bonusTaskIndex, false, bonusType);
                showToast('বোনাস যোগ হয়েছে।');
            }
        }

        // ==========================================
        // DAILY BONUS LOGIC
        // ==========================================
        function openDailyBonusModal() {
            const modal = document.getElementById('daily-bonus-modal');
            modal.classList.remove('hidden');
            
            const now = Date.now();
            const lastClaim = currentUser.lastDailyBonus || 0;
            const timerDiv = document.getElementById('daily-bonus-timer');
            const adsGrid = document.querySelector('.daily-bonus-ads-grid');

            if (now - lastClaim < DAILY_BONUS_COOLDOWN) {
                adsGrid.style.display = 'none';
                timerDiv.style.display = 'block';
                updateDailyBonusTimer(lastClaim + DAILY_BONUS_COOLDOWN);
            } else {
                adsGrid.style.display = 'grid';
                timerDiv.style.display = 'none';
            }
        }

        function closeDailyBonusModal() { document.getElementById('daily-bonus-modal').classList.add('hidden'); }

        function clickBonusAd(index) {
            const btn = event.currentTarget;
            btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> লোড হচ্ছে...`;
            btn.style.pointerEvents = 'none';

            setTimeout(() => {
                currentUser.balance += DAILY_BONUS_REWARD;
                currentUser.lastDailyBonus = Date.now();
                updateBalanceDisplay();
                updateFirebaseData('balance', currentUser.balance);
                updateFirebaseData('lastDailyBonus', currentUser.lastDailyBonus);
                showToast(`অভিনন্দন! আপনি ${DAILY_BONUS_REWARD} টাকা বোনাস পেয়েছেন।`);
                closeDailyBonusModal();
            }, 2000);
        }

        let dailyBonusTimerInterval;
        function updateDailyBonusTimer(expiryTime) {
            if(dailyBonusTimerInterval) clearInterval(dailyBonusTimerInterval);
            const timerDisplay = document.getElementById('daily-bonus-timer');
            
            function tick() {
                const now = Date.now();
                const diff = expiryTime - now;
                if (diff <= 0) {
                    clearInterval(dailyBonusTimerInterval);
                    openDailyBonusModal();
                    return;
                }
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                timerDisplay.textContent = `পরবর্তী বোনাস: ${hours}ঘ ${minutes}মি ${seconds}সে`;
            }
            tick();
            dailyBonusTimerInterval = setInterval(tick, 1000);
        }

        // ==========================================
        // REFERRAL MILESTONE LOGIC
        // ==========================================
        function checkReferralMilestone(referrerPhone) {
            db.ref('users/' + referrerPhone).once('value').then(snapshot => {
                const referrer = snapshot.val();
                if(!referrer || !referrer.referralTimestamps || referrer.referralMilestoneClaimed) return;
                const timestamps = Object.values(referrer.referralTimestamps);
                const now = Date.now();
                const oneDayAgo = now - (24 * 60 * 60 * 1000);
                const recentReferrals = timestamps.filter(ts => ts > oneDayAgo).length;
                if(recentReferrals >= REFERRAL_MILESTONE_COUNT) {
                    const newBalance = (referrer.balance || 0) + REFERRAL_MILESTONE_REWARD;
                    db.ref('users/' + referrerPhone + '/balance').set(newBalance);
                    db.ref('users/' + referrerPhone + '/referralMilestoneClaimed').set(true);
                    if(referrerPhone === currentUserPhone) {
                        currentUser.balance = newBalance;
                        updateBalanceDisplay();
                        showToast(`🎉 অভিনন্দন! ২৪ ঘণ্টায় ১০ জন রেফার করায় আপনি ${REFERRAL_MILESTONE_REWARD} টাকা বোনাস পেয়েছেন!`);
                    }
                }
            });
        }

        // ==========================================
        // সাপোর্ট টিকেট ফাংশন
        // ==========================================
        function openSupportTicketModal() {
            const modal = document.getElementById('support-ticket-modal');
            modal.classList.remove('hidden');
            loadTicketHistory();
        }
        function closeSupportTicketModal() { document.getElementById('support-ticket-modal').classList.add('hidden'); }
        function submitSupportTicket() {
            const subject = document.getElementById('ticket-subject').value.trim();
            const message = document.getElementById('ticket-message').value.trim();
            if(!subject || !message) { showToast('বিষয় এবং মেসেজ অবশ্যই দিতে হবে।'); return; }
            const newTicket = { id: Date.now(), subject: subject, message: message, date: new Date().toISOString(), status: 'open', adminReply: '' };
            const tickets = currentUser.supportTickets || [];
            tickets.unshift(newTicket);
            updateFirebaseData('supportTickets', tickets);
            document.getElementById('ticket-subject').value = '';
            document.getElementById('ticket-message').value = '';
            showToast('টিকেট সফলভাবে জমা হয়েছে! অ্যাডমিন শীঘ্রই উত্তর দেবেন।');
            loadTicketHistory();
        }
        function loadTicketHistory() {
            const container = document.getElementById('ticket-history');
            const tickets = currentUser.supportTickets || [];
            if(tickets.length === 0) { container.innerHTML = '<div style="text-align: center; padding: 15px; color: #666; font-size: 0.8rem;">কোন টিকেট খুঁজে পাওয়া যায়নি</div>'; return; }
            container.innerHTML = '';
            tickets.forEach(ticket => {
                const dateObj = new Date(ticket.date);
                const dateStr = dateObj.toLocaleDateString() + ' ' + dateObj.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                let statusClass = 'status-open';
                if(ticket.status === 'closed') statusClass = 'status-closed';
                if(ticket.status === 'pending') statusClass = 'status-pending';
                const div = document.createElement('div');
                div.className = 'ticket-item';
                div.innerHTML = `<div class="ticket-subject">${ticket.subject}</div><div class="ticket-date">${dateStr}</div><div class="ticket-status ${statusClass}">${ticket.status === 'open' ? 'খোলা আছে' : ticket.status === 'closed' ? 'বন্ধ' : 'প্রক্রিয়াধীন'}</div>`;
                container.appendChild(div);
            });
        }

        // ==========================================
        // NEW: ADD MONEY LOGIC
        // ==========================================
        function openAddMoneyModal() {
            const modal = document.getElementById('add-money-modal');
            modal.classList.remove('hidden');
            document.getElementById('sender-number').value = '';
            document.getElementById('deposit-amount').value = '';
            document.getElementById('trx-id').value = '';
            document.getElementById('promo-code').value = '';
            document.getElementById('promo-msg').textContent = '';
            renderDepositHistory();
        }
        function closeAddMoneyModal() { document.getElementById('add-money-modal').classList.add('hidden'); }
        function applyPromo() {
            const code = document.getElementById('promo-code').value.trim().toUpperCase();
            const msg = document.getElementById('promo-msg');
            if(code === 'BONUS50') { msg.textContent = '✅ বোনাস কোড সফল! ডিপোজিটের সাথে ৫০ টাকা বোনাস পাবেন।'; msg.style.color = '#10b981'; } 
            else { msg.textContent = '❌ ভুল প্রোমো কোড!'; msg.style.color = '#ef4444'; }
        }
        function submitDepositRequest() {
            const method = document.getElementById('deposit-method').value;
            const sender = document.getElementById('sender-number').value.trim();
            const amountInput = document.getElementById('deposit-amount').value;
            const trx = document.getElementById('trx-id').value.trim();
            const amount = parseFloat(amountInput);
            if (sender.length < 11) { showToast('সঠিক সেন্ডার নম্বর দিন।'); return; }
            if (isNaN(amount) || amount < 50) { showToast('মিনিমাম ডিপোজিট ৫০ টাকা।'); return; }
            if (trx.length < 5) { showToast('সঠিক TrxID দিন।'); return; }
            const btn = document.getElementById('btn-submit-deposit');
            const originalText = btn.textContent;
            btn.textContent = 'জমা হচ্ছে...';
            btn.disabled = true;
            const newDeposit = { id: Date.now(), method: method, sender: sender, amount: amount, trx: trx, date: new Date().toISOString(), status: 'Pending' };
            const currentDeposits = currentUser.deposits || [];
            currentDeposits.unshift(newDeposit);
            updateFirebaseData('deposits', currentDeposits);
            setTimeout(() => {
                btn.textContent = originalText; btn.disabled = false;
                showToast('ডিপোজিট রিকোয়েস্ট সফলভাবে জমা হয়েছে! অ্যাডমিন অ্যাপ্রুভ করার অপেক্ষা করুন।');
                document.getElementById('deposit-amount').value = '';
                document.getElementById('trx-id').value = '';
                renderDepositHistory();
                closeAddMoneyModal();
            }, 1000);
        }
        function renderDepositHistory() {
            const listContainer = document.getElementById('deposit-history-list');
            const deposits = currentUser.deposits || [];
            if (deposits.length === 0) { listContainer.innerHTML = '<div style="text-align: center; padding: 10px; font-size: 0.8rem; color: #666;">কোনো হিস্ট্রি নেই</div>'; return; }
            listContainer.innerHTML = '';
            deposits.forEach(d => {
                const dateObj = new Date(d.date);
                const dateStr = dateObj.toLocaleDateString() + ' ' + dateObj.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                let statusClass = 'status-pending';
                if(d.status === 'Approved') statusClass = 'status-approved';
                if(d.status === 'Rejected') statusClass = 'status-rejected';
                const item = document.createElement('div');
                item.className = 'history-item deposit-history-item';
                item.innerHTML = `<div class="h-left"><span class="h-method">${d.method.toUpperCase()} (${d.sender})</span><span class="h-date">${dateStr}</span></div><div class="h-right"><div class="h-amount">+৳${d.amount.toFixed(2)}</div><div class="h-status ${statusClass}">${d.status}</div></div>`;
                listContainer.appendChild(item);
            });
        }

        // ==========================================
        // NEW: PROFESSIONAL WITHDRAWAL SYSTEM
        // ==========================================
        function openWithdrawModal() {
            const modal = document.getElementById('withdraw-modal');
            modal.classList.remove('hidden');
            document.getElementById('withdraw-balance-display').textContent = currentUser.balance.toFixed(2);
            document.getElementById('withdraw-account').value = '';
            document.getElementById('withdraw-amount').value = '';
            renderWithdrawHistory();
        }
        function closeWithdrawModal() { document.getElementById('withdraw-modal').classList.add('hidden'); }
        function selectPaymentMethod(method, element) {
            selectedWithdrawMethod = method;
            document.querySelectorAll('.pay-method-card').forEach(card => { card.classList.remove('selected'); });
            element.classList.add('selected');
        }
        function handleWithdrawal() {
            const accountNumber = document.getElementById('withdraw-account').value.trim();
            const amountInput = document.getElementById('withdraw-amount').value;
            const amount = parseFloat(amountInput);
            if (isNaN(amount) || amount <= 0) { showToast('সঠিক টাকার পরিমাণ লিখুন।'); return; }
            if (amount < MIN_WITHDRAW) { showToast(`মিনিমাম উত্তোলন করতে হলে ${MIN_WITHDRAW} টাকা প্রয়োজন।`); return; }
            if (amount > currentUser.balance) { showToast('আপনার অ্যাকাউন্টে পর্যাপ্ত ব্যালেন্স নেই!'); return; }
            if (accountNumber.length < 11 || isNaN(accountNumber)) { showToast('সঠিক মোবাইল নম্বার দিন (১১ ডিজিট)।'); return }
            const btn = document.getElementById('btn-submit-withdraw');
            const originalText = btn.textContent;
            btn.textContent = 'প্রসেসিং হচ্ছে...';
            btn.disabled = true;
            const newWithdrawal = { id: Date.now(), method: selectedWithdrawMethod, account: accountNumber, amount: amount, date: new Date().toISOString(), status: 'Pending' };
            const currentWithdrawals = currentUser.withdrawals || [];
            currentWithdrawals.unshift(newWithdrawal);
            currentUser.balance -= amount;
            updateFirebaseData('balance', currentUser.balance);
            updateFirebaseData('withdrawals', currentWithdrawals);
            setTimeout(() => {
                btn.textContent = originalText; btn.disabled = false;
                showToast('উত্তোলন রিকোয়েস্ট সফলভাবে জমা হয়েছে!');
                updateBalanceDisplay();
                document.getElementById('withdraw-balance-display').textContent = currentUser.balance.toFixed(2);
                document.getElementById('withdraw-amount').value = '';
                renderWithdrawHistory();
            }, 1000);
        }
        function renderWithdrawHistory() {
            const listContainer = document.getElementById('withdraw-history-list');
            const withdrawals = currentUser.withdrawals || [];
            if (withdrawals.length === 0) { listContainer.innerHTML = '<div style="text-align: center; padding: 10px; font-size: 0.8rem; color: #666;">কোনো হিস্ট্রি নেই</div>'; return; }
            listContainer.innerHTML = '';
            withdrawals.forEach(w => {
                const dateObj = new Date(w.date);
                const dateStr = dateObj.toLocaleDateString() + ' ' + dateObj.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                let statusClass = 'status-pending';
                if(w.status === 'Approved') statusClass = 'status-approved';
                if(w.status === 'Rejected') statusClass = 'status-rejected';
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `<div class="h-left"><span class="h-method">${w.method.toUpperCase()} - ${w.account}</span><span class="h-date">${dateStr}</span></div><div class="h-right"><div class="h-amount">৳${w.amount.toFixed(2)}</div><div class="h-status ${statusClass}">${w.status}</div></div>`;
                listContainer.appendChild(item);
            });
        }

        // ==========================================
        // MEMBERSHIP SYSTEM LOGIC
        // ==========================================
        function checkMembershipExpiry() {
            if(!currentUser.membership) return;
            const mem = currentUser.membership;
            const now = new Date().getTime();
            if (now > mem.endDate && mem.status === 'active') { mem.status = 'expired'; updateFirebaseData('membership', mem); }
        }
        function openMembershipPlans() { document.getElementById('membership-plans-modal').classList.remove('hidden'); }
        function closeMembershipPlans() { document.getElementById('membership-plans-modal').classList.add('hidden'); }
        function initiateMembership() {
            if(!currentUser.membership) { openMembershipPlans(); } else { openMyMembership(); }
        }
        function initiatePurchase(planType) {
            selectedPlanType = planType;
            const plan = MEMBERSHIP_PLANS[planType];
            document.getElementById('pay-plan-name').textContent = plan.name;
            document.getElementById('pay-validity').textContent = plan.days + ' Days';
            document.getElementById('pay-daily').textContent = '৳' + plan.daily;
            document.getElementById('pay-price').textContent = '৳' + plan.price;
            document.getElementById('pay-wallet-bal').textContent = currentUser.balance.toFixed(2);
            document.getElementById('membership-plans-modal').classList.add('hidden');
            document.getElementById('payment-modal').classList.remove('hidden');
        }
        function closePaymentModal() {
            document.getElementById('payment-modal').classList.add('hidden');
            selectedPlanType = null;
        }
        function confirmPurchase() {
            if(!selectedPlanType) return;
            const plan = MEMBERSHIP_PLANS[selectedPlanType];
            if(currentUser.balance < plan.price) { showToast('পর্যাপ্ত ব্যালেন্স নেই! দয়া করে ওয়ালেটে টাকা যোগ করুন।'); return; }
            currentUser.balance -= plan.price;
            updateBalanceDisplay();
            const now = new Date();
            const startDate = now.getTime();
            const endDate = startDate + (plan.days * 24 * 60 * 60 * 1000);
            const newMembership = { planType: selectedPlanType, startDate: startDate, endDate: endDate, dailyAmount: plan.daily, claimedAmount: 0, status: 'active', lastClaimDate: null, history: [] };
            updateFirebaseData('balance', currentUser.balance);
            updateFirebaseData('membership', newMembership);
            showToast('মেম্বারশিপ সফলভাবে সক্রিয় হয়েছে!');
            closePaymentModal();
            openMyMembership();
        }
        function openMyMembership() {
            const modal = document.getElementById('my-membership-modal');
            const activeView = document.getElementById('membership-active-view');
            const planDetails = document.getElementById('plan-details');
            const buyCta = document.getElementById('buy-plan-cta');
            const statusBadge = document.getElementById('dash-status-badge');
            modal.classList.remove('hidden');
            if(!currentUser.membership) {
                planDetails.classList.add('hidden');
                buyCta.classList.remove('hidden');
                statusBadge.classList.add('hidden');
                document.getElementById('dash-plan-name').textContent = "No Active Plan";
            } else {
                const mem = currentUser.membership;
                const planConfig = MEMBERSHIP_PLANS[mem.planType];
                buyCta.classList.add('hidden');
                planDetails.classList.remove('hidden');
                statusBadge.classList.remove('hidden');
                document.getElementById('dash-plan-name').textContent = planConfig.name + " Plan";
                const startObj = new Date(mem.startDate);
                const endObj = new Date(mem.endDate);
                document.getElementById('dash-start').textContent = startObj.toLocaleDateString();
                document.getElementById('dash-end').textContent = endObj.toLocaleDateString();
                const now = new Date().getTime();
                const diffTime = Math.max(0, mem.endDate - now);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                document.getElementById('dash-days-left').textContent = diffDays + " Days";
                document.getElementById('dash-daily').textContent = '৳' + mem.dailyAmount;
                document.getElementById('dash-total-claimed').textContent = '৳' + mem.claimedAmount.toFixed(2);
                document.getElementById('claim-amount-btn').textContent = mem.dailyAmount;
                statusBadge.textContent = mem.status.toUpperCase();
                statusBadge.className = 'membership-status-badge ' + (mem.status === 'active' ? 'status-active' : 'status-expired');
                renderHistory();
                updateClaimButtonState();
                startClaimTimer();
            }
        }
        function closeMyMembership() {
            document.getElementById('my-membership-modal').classList.add('hidden');
            if(membershipTimerInterval) clearInterval(membershipTimerInterval);
        }
        function updateClaimButtonState() {
            const btn = document.getElementById('claim-income-btn');
            const timerDiv = document.getElementById('claim-timer');
            const mem = currentUser.membership;
            if(!mem || mem.status !== 'active') { btn.disabled = true; btn.textContent = "Membership Expired"; timerDiv.classList.add('hidden'); return; }
            const now = new Date();
            const lastClaim = mem.lastClaimDate ? new Date(mem.lastClaimDate) : null;
            if (lastClaim && lastClaim.getDate() === now.getDate() && lastClaim.getMonth() === now.getMonth() && lastClaim.getFullYear() === now.getFullYear()) {
                btn.disabled = true; btn.innerHTML = `<i class="fas fa-check"></i> Claimed Today`; timerDiv.classList.remove('hidden');
            } else { btn.disabled = false; btn.innerHTML = `<i class="fas fa-hand-holding-usd"></i> Claim ৳${mem.dailyAmount}`; timerDiv.classList.add('hidden'); }
        }
        function startClaimTimer() {
            if(membershipTimerInterval) clearInterval(membershipTimerInterval);
            const mem = currentUser.membership;
            if(!mem || mem.status !== 'active' || !mem.lastClaimDate) return;
            const timerDiv = document.getElementById('claim-timer');
            timerDiv.classList.remove('hidden');
            membershipTimerInterval = setInterval(() => {
                const now = new Date().getTime();
                const lastClaimTime = new Date(mem.lastClaimDate).getTime();
                const nextClaimTime = lastClaimTime + (24 * 60 * 60 * 1000);
                const diff = nextClaimTime - now;
                if (diff <= 0) { clearInterval(membershipTimerInterval); updateClaimButtonState(); } 
                else {
                    const h = Math.floor(diff / (1000 * 60 * 60));
                    const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const s = Math.floor((diff % (1000 * 60)) / 1000);
                    timerDiv.textContent = `Next claim in: ${h}h ${m}m ${s}s`;
                }
            }, 1000);
        }
        function claimDailyIncome() {
            const mem = currentUser.membership;
            if(!mem || mem.status !== 'active') return;
            const now = new Date();
            const lastClaim = mem.lastClaimDate ? new Date(mem.lastClaimDate) : null;
            if (lastClaim && lastClaim.getDate() === now.getDate() && lastClaim.getMonth() === now.getMonth()) {
                showToast('আপনি আজকে ইতিমধ্যেই ক্লেইম করেছেন।');
                return;
            }
            currentUser.balance += mem.dailyAmount;
            mem.claimedAmount += mem.dailyAmount;
            mem.lastClaimDate = now.getTime();
            mem.history.push({ date: now.toISOString(), amount: mem.dailyAmount, status: 'Success' });
            updateFirebaseData('balance', currentUser.balance);
            updateFirebaseData('membership', mem);
            updateBalanceDisplay();
            updateClaimButtonState();
            renderHistory();
            startClaimTimer();
            showToast(`৳${mem.dailyAmount} আপনার ওয়ালেটে যোগ হয়েছে!`);
        }
        function renderHistory() {
            const list = document.getElementById('claim-history-list');
            list.innerHTML = '';
            const history = currentUser.membership.history || [];
            if(history.length === 0) { list.innerHTML = '<div style="text-align:center; color:#555; padding:10px;">কোনো হিস্ট্রি নেই</div>'; return; }
            history.slice().reverse().slice(0, 10).forEach(item => {
                const dateObj = new Date(item.date);
                const dateStr = dateObj.toLocaleDateString() + ' ' + dateObj.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `<div><div style="font-weight:bold;">৳${item.amount}</div><div style="font-size:0.7rem; color:#666;">${dateStr}</div></div><div class="history-status ${item.status === 'Success' ? 'history-success' : 'history-missed'}">${item.status}</div>`;
                list.appendChild(div);
            });
        }

        // ==========================================
        // REFERRAL SYSTEM LOGIC
        // ==========================================
        function openReferralModal() {
            if(!currentUser.referralCode) {
                const code = generateRefCode();
                updateFirebaseData('referralCode', code);
                setTimeout(() => openReferralModal(), 500);
                return;
            }
            const modal = document.getElementById('referral-modal');
            const codeDisplay = document.getElementById('my-ref-code');
            const qrImg = document.getElementById('ref-qr-img');
            codeDisplay.textContent = currentUser.referralCode;
            qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${currentUser.referralCode}`;
            const timestamps = currentUser.referralTimestamps ? Object.values(currentUser.referralTimestamps) : [];
            const now = Date.now();
            const oneDayAgo = now - (24 * 60 * 60 * 1000);
            const count24h = timestamps.filter(ts => ts > oneDayAgo).length;
            document.getElementById('milestone-progress').innerHTML = `চলতি ২৪ঘণ্টা: <strong>${count24h}</strong> জন / ১০ জন`;
            const stats = currentUser.refStats || { totalReferrals: 0, activeReferrals: 0, totalIncome: 0, withdrawableRefBalance: 0 };
            document.getElementById('stat-total-ref').textContent = stats.totalReferrals;
            document.getElementById('stat-active-ref').textContent = stats.activeReferrals;
            document.getElementById('stat-ref-income').textContent = stats.totalIncome.toFixed(2);
            document.getElementById('stat-withdrawable').textContent = stats.withdrawableRefBalance.toFixed(2);
            db.ref('users').once('value').then(snapshot => {
                const users = snapshot.val() || {};
                const usersArray = Object.values(users);
                const topReferrers = usersArray.sort((a, b) => (b.refStats.activeReferrals || 0) - (a.refStats.activeReferrals || 0)).slice(0, 5);
                renderLeaderboard(topReferrers);
            });
            renderReferralList();
            modal.classList.remove('hidden');
        }
        function closeReferralModal() { document.getElementById('referral-modal').classList.add('hidden'); }
        function copyRefCode() {
            const code = currentUser.referralCode;
            const textArea = document.createElement("textarea");
            textArea.value = code; document.body.appendChild(textArea); textArea.select(); document.execCommand("Copy"); textArea.remove();
            showToast('রেফারেল কোড কপি হয়েছে!');
        }
        function shareReferral(platform) {
            const code = currentUser.referralCode;
            const currentUrl = window.location.href.split('?')[0];
            const shareUrl = `${currentUrl}?ref=${code}`;
            const message = `এই app-এ কাজ করে ৫০০+ টাকা ইনকাম করো 💰\nআমার referral code ব্যবহার করো: ${code}\nলিংক: ${shareUrl}`;
            const encodedMsg = encodeURIComponent(message);
            let url = '';
            if (platform === 'whatsapp') { url = `https://wa.me/?text=${encodedMsg}`; }
            else if (platform === 'facebook') { url = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}&quote=${encodedMsg}`; }
            else if (platform === 'telegram') { url = `https://t.me/share/url?url=${shareUrl}&text=${encodedMsg}`; }
            else if (platform === 'copy') {
                const textArea = document.createElement("textarea"); textArea.value = message; document.body.appendChild(textArea); textArea.select(); document.execCommand("Copy"); textArea.remove();
                showToast('লিংক ও মেসেজ কপি হয়েছে!'); return;
            }
            if (url) { window.open(url, '_blank'); }
        }
        function renderLeaderboard(topReferrers) {
            const list = document.getElementById('lb-list'); list.innerHTML = '';
            if(topReferrers.length === 0) { list.innerHTML = '<li style="text-align:center; color:#555; padding:10px; font-size:0.8rem;">এখনো কেউ নেই</li>'; return; }

            topReferrers.forEach((u, index) => {
                const li = document.createElement('li');
                li.className = 'lb-item';
                const avatarSeed = u.phone.replace(/\D/g,'');
                li.innerHTML = `
                    <span class="lb-rank">#${index + 1}</span>
                    <img src="https://picsum.photos/seed/${avatarSeed}/40/40" class="lb-avatar">
                    <span class="lb-name">${u.name}</span>
                    <span class="lb-earn">${(u.refStats.activeReferrals || 0)} Refs</span>
                `;
                list.appendChild(li);
            });
        }

        function renderReferralList() {
            const container = document.getElementById('referral-list-container');
            container.innerHTML = '';
           
            const myRefs = currentUser.refStats.referredUsers || [];
            
            if (myRefs.length === 0) {
                container.innerHTML = '<div style="text-align:center; color:#555; padding:15px; font-size:0.8rem;">আপনি এখনো কাউকে রেফার করেননি।</div>';
                return;
            }

            const refsArray = Array.isArray(myRefs) ? myRefs : Object.values(myRefs);

            refsArray.forEach((ref, idx) => {
                if(ref.phone) {
                    db.ref('users/' + ref.phone).once('value').then(snapshot => {
                        const friendObj = snapshot.val();
                        let statusClass = 'status-pending';
                        let statusText = 'Pending';
                        let earned = '৳0.00';

                        if (friendObj) {
                            const isActive = (friendObj.balance > 0) || (friendObj.membership) || (friendObj.dailyWebTasks && !friendObj.dailyWebTasks[0]);

                            if (isActive) {
                                statusClass = 'status-active';
                                statusText = 'Verified';
                               
                                if (ref.earnedFromThis === 0) {
                                    ref.earnedFromThis = REFERRAL_REWARD;
                                    currentUser.refStats.totalIncome += REFERRAL_REWARD;
                                    currentUser.refStats.withdrawableRefBalance += REFERRAL_REWARD;
                                    currentUser.refStats.activeReferrals++;
                                    
                                    db.ref('users/' + currentUserPhone + '/refStats/referredUsers/' + (ref.id || idx)).update({
                                        earnedFromThis: ref.earnedFromThis
                                    });
                                    db.ref('users/' + currentUserPhone + '/refStats').set(currentUser.refStats);
                                    db.ref('users/' + currentUserPhone + '/balance').set(currentUser.balance + REFERRAL_REWARD);
                                    currentUser.balance += REFERRAL_REWARD;
                                    updateBalanceDisplay();

                                    document.getElementById('stat-active-ref').textContent = currentUser.refStats.activeReferrals;
                                    document.getElementById('stat-ref-income').textContent = currentUser.refStats.totalIncome.toFixed(2);
                                    document.getElementById('stat-withdrawable').textContent = currentUser.refStats.withdrawableRefBalance.toFixed(2);
                                }
                                earned = `৳${ref.earnedFromThis.toFixed(2)}`;
                            } else {
                                statusText = 'Joined';
                            }
                        }

                        const dateStr = new Date(ref.joinedDate).toLocaleDateString();

                        const div = document.createElement('div');
                        div.className = 'ref-list-item';
                        div.innerHTML = `
                            <div class="ref-user-info">
                                <div class="ref-avatar-small"><i class="fas fa-user"></i></div>
                                <div>
                                    <div class="ref-name">${ref.name || 'User'}</div>
                                    <div class="ref-date">${dateStr}</div>
                                </div>
                            </div>
                            <div>
                                <div class="ref-status-badge ${statusClass}" id="ref-status-${ref.phone}">${statusText}</div>
                                <div class="ref-earned" id="ref-earned-${ref.phone}">${earned}</div>
                            </div>
                        `;
                        
                        if(!document.getElementById(`ref-status-${ref.phone}`)) {
                             container.appendChild(div);
                        }
                    });
                }
            });
        }

        // ==========================================
        // SPIN WHEEL LOGIC
        // ==========================================
        function openSpinModal() {
            const now = Date.now();
            const lastSpin = currentUser.lastSpin || 0;
            const modal = document.getElementById('spin-modal');
            const btn = document.getElementById('spin-btn');
            const timerDisplay = document.getElementById('spin-timer');
            const wheel = document.getElementById('wheel-inner');
            modal.classList.remove('hidden');
            if (now - lastSpin < SPIN_COOLDOWN) {
                btn.classList.add('hidden');
                timerDisplay.classList.remove('hidden');
                updateTimer(lastSpin + SPIN_COOLDOWN);
            } else {
                btn.classList.remove('hidden');
                timerDisplay.classList.add('hidden');
                wheel.style.transition = 'none';
            }
        }

        let timerInterval;
        function updateTimer(expiryTime) {
            if(timerInterval) clearInterval(timerInterval);
            const timerDisplay = document.getElementById('spin-timer');
            function tick() {
                const now = Date.now();
                const diff = expiryTime - now;
                if (diff <= 0) {
                    clearInterval(timerInterval);
                    document.getElementById('spin-btn').classList.remove('hidden');
                    timerDisplay.classList.add('hidden');
                    return;
                }
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                timerDisplay.textContent = `পরবর্তী স্পিন: ${hours}ঘ ${minutes}মি ${seconds}সে`;
            }
            tick();
            timerInterval = setInterval(tick, 1000);
        }

        function startSpin() {
            const btn = document.getElementById('spin-btn');
            const wheel = document.getElementById('wheel-inner');
            btn.disabled = true;
            const extraSpins = 5 * 360;
            const randomDegree = Math.floor(Math.random() * 360);
            currentRotation += extraSpins + randomDegree;
            wheel.style.transition = 'transform 4s cubic-bezier(0.2, 0.8, 0.2, 0.99)';
            wheel.style.transform = `rotate(${currentRotation}deg)`;
            setTimeout(() => {
                finishSpin();
            }, 4000);
        }

        function finishSpin() {
            currentUser.balance += SPIN_REWARD;
            currentUser.lastSpin = Date.now();
            updateBalanceDisplay();
            updateFirebaseData('balance', currentUser.balance);
            updateFirebaseData('lastSpin', currentUser.lastSpin);
           
            document.getElementById('spin-modal').classList.add('hidden');
           
            bonusType = 'spin';
            claimDoubleBonus();
        }

        // ==========================================
        // DAILY TASK LOGIC
        // ==========================================
        function openDailyTaskModal() {
            document.getElementById('daily-task-modal').classList.remove('hidden');
            document.getElementById('task-ip-display').textContent = currentUser.ip || 'Checking...';
            renderTasks();
        }
        function closeDailyTaskModal() {
            document.getElementById('daily-task-modal').classList.add('hidden');
            if(activeTaskTimer) clearInterval(activeTaskTimer);
        }

        function checkDailyTaskReset() {
            const today = new Date().toDateString();
            if (currentUser.lastTaskDate !== today) {
                updateFirebaseData('dailyWebTasks', [false, false, false, false, false]);
                updateFirebaseData('dailyAppTasks', [false, false, false, false, false]);
                updateFirebaseData('dailySurveyTasks', [false, false, false]);
                updateFirebaseData('dailyMegaTasks', [false]);
                updateFirebaseData('lastTaskDate', today);
            }
        }

        function switchTaskTab(type) {
            ['web-task-list', 'app-task-list', 'survey-task-list', 'mega-task-list'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            ['btn-web', 'btn-app', 'btn-survey', 'btn-mega'].forEach(id => {
                document.getElementById(id).classList.remove('active');
            });

            document.getElementById(`${type}-task-list`).classList.remove('hidden');
            document.getElementById(`btn-${type}`).classList.add('active');
        }

        function renderTasks() {
            renderWebTasks();
            renderAppTasks();
            renderSurveyTasks();
            renderMegaTasks();
        }

        // ==========================================
        // SHARED IN-APP BROWSER LOGIC
        // ==========================================
        let inAppTimerInterval = null;

        function openInAppBrowser(url, index, taskType, duration, hideTimer = false) {
            const browserModal = document.getElementById('in-app-browser');
            const iframe = document.getElementById('browser-iframe');
            const urlDisplay = document.getElementById('browser-url-display');
            const timerContainer = document.getElementById('timer-container-default');

            browserModal.classList.remove('hidden');
            urlDisplay.textContent = url;
            
            window.open(url, '_blank');

            iframe.src = url;

            timerContainer.innerHTML = `
                <i class="fas fa-hourglass-half timer-icon"></i>
                <div class="timer-circle" id="browser-timer">${duration}</div>
                <div class="timer-label">টাইম বাকি<br>Wait</div>
            `;

            if (hideTimer) {
                timerContainer.innerHTML = `
                    <i class="fas fa-wifi timer-icon waiting"></i>
                    <div class="timer-circle" style="border-color: #3b82f6; font-size: 0.8rem;"><i class="fas fa-spinner fa-spin"></i></div>
                    <div class="timer-label">ডিভাইস যাচাই<br>চলছে...</div>
                `;
                isMegaOfferCompleted = false;
            }

            let timeLeft = duration;

            if (inAppTimerInterval) clearInterval(inAppTimerInterval);

            inAppTimerInterval = setInterval(() => {
                timeLeft--;
               
                if (hideTimer) {
                    if (timeLeft <= 0) {
                        isMegaOfferCompleted = true;
                        timerContainer.innerHTML = `
                            <i class="fas fa-check-circle timer-icon success"></i>
                            <div class="timer-circle" style="border-color: var(--success); background: rgba(34,197,94,0.1);"><i class="fas fa-check"></i></div>
                            <div class="timer-label" style="color: var(--success);">অফার সম্পন্ন<br>বন্ধ করুন</div>
                        `;
                    }
                } else {
                    const timerDisplay = document.getElementById('browser-timer');
                    if(timerDisplay) timerDisplay.textContent = timeLeft;

                    if (timeLeft <= 0) {
                        clearInterval(inAppTimerInterval);
                        if (taskType === 'web') finishWebTask(index);
                        if (taskType === 'app') finishAppInstall(index);
                        if (taskType === 'survey') finishSurveyTask(index);
                    }
                }
            }, 1000);
        }

        function closeInAppBrowser() {
            const browserModal = document.getElementById('in-app-browser');
            if (activeTaskIndex && activeTaskIndex.startsWith('mega-')) {
                if (isMegaOfferCompleted) {
                    finishMegaTask(0);
                } else {
                    showToast('অফারটি সম্পন্ন হওয়া পর্যন্ত অপেক্ষা করুন।');
                    return;
                }
            }

            browserModal.classList.add('hidden');
            if (inAppTimerInterval) clearInterval(inAppTimerInterval);
            document.getElementById('browser-iframe').src = 'about:blank';
        }

        // ==========================================
        // WEB TASKS
        // ==========================================
        function renderWebTasks() {
            const list = document.getElementById('web-task-list');
            list.innerHTML = '';
            currentUser.dailyWebTasks.forEach((isDone, index) => {
                const li = document.createElement('li');
                li.className = `task-item ${isDone ? 'completed-task' : ''}`;
               
                let btnHtml = '';
                if (isDone) {
                    btnHtml = `<button class="task-btn" disabled><i class="fas fa-check"></i> সম্পন্ন</button>`;
                } else if (activeTaskIndex === 'web-' + index) {
                    btnHtml = `<button class="task-btn" disabled><i class="fas fa-spinner fa-spin"></i> চলছে...</button>`;
                } else if (activeTaskIndex !== null) {
                    btnHtml = `<button class="task-btn" disabled>অপেক্ষা করুন</button>`;
                } else {
                    btnHtml = `<button class="task-btn" onclick="startWebTask(${index})">কাজ শুরু করুন</button>`;
                }
               
                li.innerHTML = `
                    <div style="font-size: 1.5rem; color: var(--primary-color);"><i class="fas fa-globe"></i></div>
                    <div class="task-info">
                        <h4>ওয়েবসাইট ভিজিট #${index + 1}</h4>
                        <p>রিওয়ার্ড: ৳${WEB_REWARD}</p>
                    </div>
                    <div class="task-action">${btnHtml}</div>
                `;
                list.appendChild(li);
            });
        }

        function startWebTask(index) {
            activeTaskIndex = 'web-' + index;
            renderTasks();
            const link = webTaskLinks[index];
            openInAppBrowser(link, index, 'web', WEB_TASK_DURATION);
        }

        function finishWebTask(index) {
            closeInAppBrowser(true);
            bonusType = 'web';
            bonusTaskIndex = index;
            claimDoubleBonus();
        }

        // ==========================================
        // APP INSTALL TASKS
        // ==========================================
        function renderAppTasks() {
            const list = document.getElementById('app-task-list');
            list.innerHTML = '';
            currentUser.dailyAppTasks.forEach((isDone, index) => {
                const li = document.createElement('li');
                li.className = `task-item ${isDone ? 'completed-task' : ''}`;
               
                let btnHtml = '';
                if (isDone) {
                    btnHtml = `<button class="task-btn" disabled><i class="fas fa-check"></i> সম্পন্ন</button>`;
                } else if (activeTaskIndex === 'app-' + index) {
                    btnHtml = `<button class="task-btn install-btn" disabled><i class="fas fa-spinner fa-spin"></i> চলছে...</button>`;
                } else if (activeTaskIndex !== null) {
                    btnHtml = `<button class="task-btn install-btn" disabled>অপেক্ষা করুন</button>`;
                } else {
                    btnHtml = `<button class="task-btn install-btn" onclick="startAppInstall(${index})">ইন্সটল করুন</button>`;
                }

                li.innerHTML = `
                    <div style="font-size: 1.5rem; color: #8e44ad;"><i class="fab fa-android"></i></div>
                    <div class="task-info">
                        <h4>এপ্স ইন্সটল #${index + 1}</h4>
                        <p>রিওয়ার্ড: ৳${APP_REWARD}</p>
                    </div>
                    <div class="task-action">${btnHtml}</div>
                `;
                list.appendChild(li);
            });
        }

        function startAppInstall(index) {
            activeTaskIndex = 'app-' + index;
            renderTasks();
            const link = appInstallLinks[index];
            if(link) {
                openInAppBrowser(link, index, 'app', APP_TASK_DURATION);
            } else {
                window.open('https://earning-pro-phi.vercel.app/', '_blank');
            }
        }

        function finishAppInstall(index) {
            closeInAppBrowser(true);
            bonusType = 'app';
            bonusTaskIndex = index;
            claimDoubleBonus();
        }

        // --- Survey Tasks
        function renderSurveyTasks() {
            const list = document.getElementById('survey-task-list');
            list.innerHTML = '';
            currentUser.dailySurveyTasks.forEach((isDone, index) => {
                const li = document.createElement('li');
                li.className = `task-item ${isDone ? 'completed-task' : ''}`;
               
                let btnHtml = '';
                if (isDone) {
                    btnHtml = `<button class="task-btn" disabled><i class="fas fa-check"></i> সম্পন্ন</button>`;
                } else if (activeTaskIndex === 'survey-' + index) {
                    btnHtml = `<button class="task-btn survey-btn" disabled><i class="fas fa-spinner fa-spin"></i> চলছে...</button>`;
                } else if (activeTaskIndex !== null) {
                    btnHtml = `<button class="task-btn survey-btn" disabled>অপেক্ষা করুন</button>`;
                } else {
                    btnHtml = `<button class="task-btn survey-btn" onclick="startSurveyTask(${index})">সার্ভে শুরু করুন</button>`;
                }
               
                li.innerHTML = `
                    <div style="font-size: 1.5rem; color: #f59e0b;"><i class="fas fa-poll"></i></div>
                    <div class="task-info">
                        <h4>সার্ভে করুন #${index + 1}</h4>
                        <p>রিওয়ার্ড: ৳${SURVEY_REWARD}</p>
                    </div>
                    <div class="task-action">${btnHtml}</div>
                `;
                list.appendChild(li);
            });
        }

        function startSurveyTask(index) {
            activeTaskIndex = 'survey-' + index;
            renderTasks();
            const link = surveyTaskLinks[index];
            if(link) {
                openInAppBrowser(link, index, 'survey', SURVEY_TASK_DURATION);
            } else {
                window.open('https://bd-voting.vercel.app/', '_blank');
            }
        }

        function finishSurveyTask(index) {
            closeInAppBrowser(true);
            bonusType = 'survey';
            bonusTaskIndex = index;
            claimDoubleBonus();
        }

        // --- Mega Offer Tasks
        function renderMegaTasks() {
            const list = document.getElementById('mega-task-list');
            list.innerHTML = '';
            currentUser.dailyMegaTasks.forEach((isDone, index) => {
                const li = document.createElement('li');
                li.className = `task-item ${isDone ? 'completed-task' : ''}`;
               
                let btnHtml = '';
                if (isDone) btnHtml = `<button class="task-btn" disabled><i class="fas fa-check"></i> সম্পন্ন</button>`;
                else if (activeTaskIndex === 'mega-' + index) btnHtml = `<button class="task-btn mega-btn" disabled><i class="fas fa-spinner fa-spin"></i> ট্র্যাক হচ্ছে...</button>`;
                else if (activeTaskIndex !== null) btnHtml = `<button class="task-btn mega-btn" disabled>অপেক্ষা করুন</button>`;
                else btnHtml = `<button class="task-btn mega-btn" onclick="startMegaTask(${index})">অফার নিন</button>`;
               
                li.innerHTML = `<div style="font-size: 1.5rem; color: #ec4899;"><i class="fas fa-gem"></i></div><div class="task-info"><h4>মেগা অফার প্রাইজ</h4><p>রিওয়ার্ড: ৳${MEGA_REWARD}</p></div><div class="task-action">${btnHtml}</div>`;
                list.appendChild(li);
            });
        }

        function startMegaTask(index) {
            activeTaskIndex = 'mega-' + index;
            renderTasks();
            const link = megaTaskLinks[index];
            if(link) {
                openInAppBrowser(link, index, 'mega', MEGA_TASK_DURATION, true);
            }
        }

        function finishMegaTask(index) {
            closeInAppBrowser(true);
            bonusType = 'mega';
            bonusTaskIndex = index;
            claimDoubleBonus();
        }

        // --- General Task Reward ---
        function claimTaskReward(index, isDouble, type) {
            let baseReward = 0;
            let taskArrayName = '';
            if(type === 'web') { baseReward = WEB_REWARD; taskArrayName = 'dailyWebTasks'; }
            else if(type === 'app') { baseReward = APP_REWARD; taskArrayName = 'dailyAppTasks'; }
            else if(type === 'survey') { baseReward = SURVEY_REWARD; taskArrayName = 'dailySurveyTasks'; }
            else if(type === 'mega') { baseReward = MEGA_REWARD; taskArrayName = 'dailyMegaTasks'; }

            const amount = isDouble ? baseReward * 2 : baseReward;
           
            currentUser.balance += amount;
            updateBalanceDisplay();
           
            const tasks = currentUser[taskArrayName];
            tasks[index] = true;
           
            updateFirebaseData('balance', currentUser.balance);
            updateFirebaseData(taskArrayName, tasks);

            activeTaskIndex = null;
            closeDailyTaskModal();
            setTimeout(() => openDailyTaskModal(), 200);
        }

        // --- Fake Live Feed Logic ---
        function startFakeFeed() {
            const names = ["রহিম", "করিম", "সুমন", "জামাল", "রিনা", "মিনা", "হাসান", "সোহেল"];
            const methods = ["Bkash", "Nagad", "Rocket"];
            const feedList = document.getElementById('feed-list');
            for(let i=0; i<3; i++) addFeedItem(names, methods, feedList);
            setInterval(() => {
                addFeedItem(names, methods, feedList);
                if(feedList.children.length > 10) feedList.removeChild(feedList.lastChild);
            }, 4000);
        }
        function addFeedItem(names, methods, container) {
            const name = names[Math.floor(Math.random() * names.length)];
            const amount = (Math.random() * (2000 - 500) + 500).toFixed(0);
            const method = methods[Math.floor(Math.random() * methods.length)];
            const seed = Math.floor(Math.random() * 1000);
            const div = document.createElement('div');
            div.className = 'feed-item';
            div.innerHTML = `<img src="https://picsum.photos/seed/${seed}/50/50" alt="user" class="feed-avatar"><div class="feed-details"><h4>${name}***</h4><p>${method} - ৳${amount}</p></div><div class="feed-time">এই মাত্র </div>`;
            container.insertBefore(div, container.firstChild);
        }

        // ==========================================
        // NEW: LIVE CHAT LOGIC
        // ==========================================
        function toggleChat() {
            const modal = document.getElementById('chat-modal');
            if(modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                document.getElementById('chat-input').focus();
            } else {
                modal.classList.add('hidden');
            }
        }

        function handleChatEnter(e) {
            if(e.key === 'Enter') {
                sendMessage();
            }
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if(!msg) return;

            const chatBody = document.getElementById('chat-body');
            const userBubble = document.createElement('div');
            userBubble.className = 'chat-bubble chat-user';
            userBubble.textContent = msg;
            chatBody.appendChild(userBubble);
            
            input.value = '';
            chatBody.scrollTop = chatBody.scrollHeight;

            setTimeout(() => {
                const adminBubble = document.createElement('div');
                adminBubble.className = 'chat-bubble chat-admin';
                adminBubble.textContent = "ধন্যবাদ! আপনার মেসেজটি আমরা পেয়েছি। শীঘ্রই অ্যাডমিন যোগাযোগ করবেন।";
                chatBody.appendChild(adminBubble);
                chatBody.scrollTop = chatBody.scrollHeight;
            }, 1000);
        }

        // --- URL Parameter Handling ---
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            if(refCode) {
                toggleAuth('register');
                setTimeout(() => {
                    const refInput = document.getElementById('reg-ref');
                    if(refInput) {
                        refInput.value = refCode.toUpperCase();
                        showToast('রেফারেল কোড স্বয়ংক্রিয়ভাবে যুক্ত হয়েছে!');
                    }
                }, 500);
            }
           
            if(currentUserPhone) {
                listenToUser(currentUserPhone);
            }
        };

        // Close double bonus modal logic specifically for non-ad clicks (just closing)
        document.getElementById('double-bonus-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeBonusPopup();
            }
        });

    </script>
</body>
</html>

